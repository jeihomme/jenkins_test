<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd"> 
<mapper namespace="frontMaster">
	
	<select id="selectFrontMasteropenDetail" parameterType="hashmap" resultType="hashmap">
		<![CDATA[
			    
		SELECT 
			INFO_IDX, 
			CATE_IDX, 
			INFO_TITL, 
			INFO_TITL_COLR, 
			INFO_TITL_SUB,
			
			INFO_LINK,
			INFO_CNTN,
			INFO_ORDE, 
			INFO_USE_YN,
			INFO_PLAYER, 
			
			INFO_CD, 
			INFO_UUID, 
			INFO_UUID_INFO,
			IFNULL(INFO_UUID_NUM, 0) AS INFO_UUID_NUM,
			
			INFO_MAST_TITL1,
			INFO_MAST_TITL2,
			INFO_MAST_SUBT1,
			INFO_MAST_SUBT2,
			
			SYS_REG_IDX, 
			SYS_REG_DTM, 
			SYS_MOD_IDX,
			SYS_MOD_DTM
		
			FROM 
				PPM_DEV.PPM_INFO
				
				WHERE CATE_IDX = #{cateIdx}
				AND INFO_USE_YN = 'Y'
				ORDER BY INFO_ORDE ASC
		
		
		]]>
	</select>

	<select id="selectFrontMasterPreviewCurriculumList" parameterType="hashmap" resultType="hashmap">
		<choose>
			<when test="codeType == 'VL' ">
				<![CDATA[
			
			SELECT 
				VOD_CD,
				VOD_USE_YN,
				VOD_NM,
				VOD_PROG_CD,
				VOD_STAT_CD,
				VOD_CNT,
				C.VOD_IDX, 
				C.DATA_IDX,
				C.DATA_CD,
				C.DATA_TITL,
				C.DATA_PC_URL,
				C.DATA_RUNN,
				C.VOD_ORDE ,
				C.DATA_FREE_YN,
				C.DATA_USE_YN,
				C.DATA_UUID,
				
				
				C.LECT_ORDE ,
				C.LECT_IDX,
				C.CATE_IDX,
				C.LECT_CD,
				C.LECT_STAT_CD,
				C.LECT_NM,
				C.LECT_UUID,
				C.LECT_STR_DTM,
				C.LECT_END_DTM,
				C.LECT_PRIC,
				C.LECT_DISC_CD,
				C.LECT_DISC,
				C.LECT_PRIC_REAL,
				C.LECT_PLAY,
				C.LECT_PLAY_LINK,
				C.LECT_RELA_PRDT1,
				C.LECT_RELA_PRDT2,
				C.LECT_RELA_PRDT3,
				C.LECT_RELA_PRDT4,
				C.LECT_RELA_PRDT5,
				C.LECT_RELA_PRDT6,
				C.LECT_USE_YN,
				C.SYS_REG_IDX,
				C.SYS_REG_DTM
			FROM PPM_PRDT_VOD PPV JOIN (
				SELECT 			
						PPVD.VOD_IDX, 
						PPVD.DATA_IDX,
						PPVD.DATA_CD,
						PPVD.DATA_TITL,
						PPVD.DATA_PC_URL,
						PPVD.DATA_RUNN,
						PPVD.DATA_ORDE AS VOD_ORDE,
						PPVD.DATA_FREE_YN,
						PPVD.DATA_USE_YN,
						PPVD.DATA_UUID,
						
						
						B.DATA_ORDE AS LECT_ORDE,
						B.LECT_IDX,
						B.CATE_IDX,
						B.LECT_CD,
						B.LECT_STAT_CD,
						B.LECT_NM,
						B.LECT_UUID,
						B.LECT_STR_DTM,
						B.LECT_END_DTM,
						B.LECT_PRIC,
						B.LECT_DISC_CD,
						B.LECT_DISC,
						B.LECT_PRIC_REAL,
						B.LECT_PLAY,
						B.LECT_PLAY_LINK,
						B.LECT_RELA_PRDT1,
						B.LECT_RELA_PRDT2,
						B.LECT_RELA_PRDT3,
						B.LECT_RELA_PRDT4,
						B.LECT_RELA_PRDT5,
						B.LECT_RELA_PRDT6,
						B.LECT_USE_YN,
						B.SYS_REG_IDX,
						B.SYS_REG_DTM
			
			
				FROM PPM_PRDT_VOD_DATA PPVD JOIN (
			
								SELECT
										VOD_IDX, 
										DATA_ORDE,
										A.LECT_IDX,
										A.CATE_IDX,
										A.LECT_CD,
										A.LECT_STAT_CD,
										A.LECT_NM,
										A.LECT_UUID,
										A.LECT_STR_DTM,
										A.LECT_END_DTM,
										A.LECT_PRIC,
										A.LECT_DISC_CD,
										A.LECT_DISC,
										A.LECT_PRIC_REAL,
										A.LECT_PLAY,
										A.LECT_PLAY_LINK,
										A.LECT_RELA_PRDT1,
										A.LECT_RELA_PRDT2,
										A.LECT_RELA_PRDT3,
										A.LECT_RELA_PRDT4,
										A.LECT_RELA_PRDT5,
										A.LECT_RELA_PRDT6,
										A.LECT_USE_YN,
										A.SYS_REG_IDX,
										A.SYS_REG_DTM
				
				
					FROM PPM_PRDT_LECT_DATA PPLD 
										JOIN (
												SELECT PSL.LECT_IDX,
															PPL.CATE_IDX,
															PPL.LECT_CD,
															PPL.LECT_STAT_CD,
															PPL.LECT_NM,
															PPL.LECT_UUID,
															PPL.LECT_STR_DTM,
															PPL.LECT_END_DTM,
															PPL.LECT_PRIC,
															PPL.LECT_DISC_CD,
															PPL.LECT_DISC,
															PPL.LECT_PRIC_REAL,
															PPL.LECT_PLAY,
															PPL.LECT_PLAY_LINK,
															PPL.LECT_RELA_PRDT1,
															PPL.LECT_RELA_PRDT2,
															PPL.LECT_RELA_PRDT3,
															PPL.LECT_RELA_PRDT4,
															PPL.LECT_RELA_PRDT5,
															PPL.LECT_RELA_PRDT6,
															PPL.LECT_USE_YN,
															PPL.SYS_REG_IDX,
															PPL.SYS_REG_DTM
										FROM 
											PPM_PRDT_LECT PPL 
												JOIN PPM_SALE_LECT PSL 
											ON	(PPL.LECT_IDX = PSL.LECT_IDX) 
												WHERE PPL.LECT_CD  = #{code}
												
												 AND PSL.SALE_USE_YN = 'Y' 
												 AND PPL.LECT_USE_YN = 'Y' 
												 AND LECT_STAT_CD ='SAL02' ) AS A
												 
							ON( A.LECT_IDX = PPLD.LECT_IDX )
							
							WHERE DATA_USE_YN = 'Y'
					) AS B 
						ON ( B.VOD_IDX = PPVD.VOD_IDX )
				
						WHERE PPVD.DATA_USE_YN = 'Y'
			
			) AS C 
				ON(PPV.VOD_IDX = C.VOD_IDX)
				
			WHERE 
				VOD_USE_YN = 'Y'
		]]>
			</when>
		
			<when test="codeType == 'CN'">
			<![CDATA[
				SELECT 
					PPT.TIME_IDX,
					PPT.CHAT_IDX,
					PPT.TIME_DTM,
					PPT.TIME_STR,
					PPT.TIME_RUN,
					PPT.TIME_USE_YN,
					
					A.CATE_IDX, 
					CHAT_CD, 
					CHAT_STAT_CD, 
					CHAT_NM, 
					CHAT_IMG_UUID,
					IMPO_IDX, 
					CHAT_REST,
					CHAT_PRIC, 
					CHAT_DISC_CD,
					CHAT_DISC,
					CHAT_PRIC_REAL,
					
					PPT.SYS_REG_IDX,
					PPT.SYS_REG_DTM
					FROM PPM_PRDT_TIME PPT JOIN
								( SELECT PPC.CHAT_IDX, PPC.CATE_IDX, CHAT_CD, CHAT_STAT_CD, CHAT_NM, CHAT_IMG_UUID, TIME_IDX, IMPO_IDX, CHAT_REST,
								CHAT_PRIC, CHAT_DISC_CD, CHAT_DISC, CHAT_PRIC_REAL, CHAT_MAIL_YN, CHAT_SMS_YN, CHAT_PW, CHAT_USE_YN
				 FROM PPM_PRDT_CHAT PPC JOIN PPM_SALE_CHAT PSC ON(PPC.CHAT_IDX = PSC.CHAT_IDX) WHERE PPC.CHAT_CD  = #{code} AND PSC.SALE_USE_YN = 'Y' AND PPC.CHAT_USE_YN = 'Y' AND CHAT_STAT_CD ='SAL02') AS A ON( PPT.CHAT_IDX = A.CHAT_IDX  )
				
				 WHERE TIME_USE_YN = 'Y'
				
			]]>
			</when>
			<when test="codeType == 'LN'">
			<![CDATA[
				
					SELECT 
						PPT.TIME_IDX,
						PPT.LIVE_IDX,
						PPT.TIME_DTM,
						PPT.TIME_STR,
						PPT.TIME_RUN,
						PPT.TIME_USE_YN,
						
						A.CATE_IDX, 
						LIVE_CD, 
						LIVE_STAT_CD, 
						LIVE_NM, 
						LIVE_IMG_UUID,
						IMPO_IDX, 
						LIVE_PRIC, 
						A.LIVE_PLAY,
						LIVE_DISC_CD,
						LIVE_DISC,
						LIVE_PRIC_REAL,
						LIVE_MAIL_DTM,
						
						PPT.SYS_REG_IDX,
						PPT.SYS_REG_DTM
						FROM PPM_PRDT_TIME PPT JOIN
									( SELECT PPL.LIVE_IDX, PPL.CATE_IDX, LIVE_CD, LIVE_STAT_CD, LIVE_NM, LIVE_IMG_UUID, TIME_IDX, IMPO_IDX, LIVE_PLAY,
									LIVE_PRIC, LIVE_DISC_CD, LIVE_DISC, LIVE_PRIC_REAL, LIVE_MAIL_DTM
					 FROM PPM_PRDT_LIVE PPL JOIN PPM_SALE_LIVE PSL ON(PPL.LIVE_IDX = PSL.LIVE_IDX) WHERE PPL.LIVE_CD  = #{code} AND PSL.SALE_USE_YN = 'Y' AND PPL.LIVE_USE_YN = 'Y' AND LIVE_STAT_CD ='SAL02') AS A ON( PPT.LIVE_IDX = A.LIVE_IDX  )
					
					 WHERE TIME_USE_YN = 'Y'
		
			]]>
			</when>
			<when test="codeType == 'FN'">
			<![CDATA[
				
				
					SELECT 
						PPT.TIME_IDX,
						PPT.FACE_IDX,
						PPT.TIME_DTM,
						PPT.TIME_STR,
						PPT.TIME_RUN,
						PPT.TIME_USE_YN,
						
						A.CATE_IDX, 
						FACE_CD, 
						FACE_STAT_CD, 
						FACE_NM, 
						FACE_IMG_UUID,
						IMPO_IDX, 
						FACE_PRIC, 
						A.FACE_REST,
						FACE_DISC_CD,
						FACE_DISC,
						FACE_PRIC_REAL,
					
						
						PPT.SYS_REG_IDX,
						PPT.SYS_REG_DTM
						FROM PPM_PRDT_TIME PPT JOIN
									( SELECT PPM.FACE_IDX, PPM.CATE_IDX, FACE_CD, FACE_STAT_CD, FACE_NM, FACE_IMG_UUID, TIME_IDX, IMPO_IDX, FACE_REST,
									FACE_PRIC, FACE_DISC_CD, FACE_DISC, FACE_PRIC_REAL
					 FROM PPM_PRDT_FACE PPM JOIN PPM_SALE_FACE PSF ON(PPM.FACE_IDX = PSF.FACE_IDX) WHERE PPM.FACE_CD  = #{code} AND PSF.SALE_USE_YN = 'Y' AND PPM.FACE_USE_YN= 'Y' AND FACE_STAT_CD ='SAL02') AS A ON( PPT.FACE_IDX = A.FACE_IDX  )
					
					 WHERE TIME_USE_YN = 'Y' 
					 
							
			]]>
			</when>
			<when test="codeType == 'EN'">
			<![CDATA[
				 SELECT 
				 	PPM.MAIL_IDX, 
				 	PPM.CATE_IDX, 
				 	MAIL_CD, 
				 	MAIL_STAT_CD, 
				 	MAIL_NM,
				 	MAIL_CNT, 
					DATE_FORMAT(MAIL_STR_DTM, '%Y-%m-%d') MAIL_STR_DTM,
					DATE_FORMAT(MAIL_END_DTM, '%Y-%m-%d') MAIL_END_DTM, 
				 	MAIL_IMG_UUID, 
				 	MAIL_REST,
					MAIL_PRIC, 
					MAIL_DISC_CD, 
					MAIL_DISC, 
					MAIL_PRIC_REAL
	 					FROM PPM_PRDT_MAIL PPM JOIN PPM_SALE_MAIL PSM 
	 					ON(PPM.MAIL_IDX = PSM.MAIL_IDX) WHERE PPM.MAIL_CD  = #{code} AND PSM.SALE_USE_YN = 'Y' AND PPM.MAIL_USE_YN= 'Y' AND MAIL_STAT_CD ='SAL02'
			]]>
			</when>
			<otherwise>
		<![CDATA[
				SELECT 1 FROM PPM_CATE PC  WHERE PC.CATE_IDX IS NULL
			]]>
			</otherwise>
		</choose>
	</select>
	
	<select id="selectFrontMasterDetail" parameterType="hashmap" resultType="hashmap">
		<![CDATA[
			    
		   
	
		    SELECT
					PU.USER_IDX,
					USER_NM,
					USER_EMAIL,
				  	DATE_FORMAT(PU.SYS_REG_DTM, '%Y-%m-%d') AS SYS_REG_DTM,
				  	DATE_FORMAT(USER_MAST_JOIN_DTM, '%Y-%m-%d') AS USER_MAST_JOIN_DTM,
				  	
				  	DATE_FORMAT(USER_LOGIN_DTM, '%Y-%m-%d %H:%i:%S') AS USER_LOGIN_DTM,
				  	DATE_FORMAT(USER_CONS_DTM, '%Y-%m-%d') AS USER_CONS_DTM,
				  	CATE_MASTEROPEN_UUID,
				  	
				  	PC.CODE_ID,
				  	CATE_CD,
				  	(SELECT CODE_NM FROM PPM_CODE PCD WHERE PCD.CODE_ID = PC.CODE_ID) CODE_NM,
				  	(SELECT CODE_NM FROM PPM_CODE PCD WHERE PCD.CODE_ID = SUBSTRING( PC.CODE_ID,1,5 )) CODE_PARENT_NM,
				  	CATE_SLOG,
				  	CATE_INFO,
				  	
				  	IFNULL((SELECT FOLL_IDX FROM PPM_USER_FOLL PUF WHERE PUF.USER_IDX = #{frontLoginIdx} AND CATE_IDX = PC.CATE_IDX AND PUF.FOLL_USE_YN = 'Y'  LIMIT 1  ), 'N' ) USER_FOLLOW_YN,
				  	
				  	PI2.INFO_MAST_TITL1,
				  	PI2.INFO_MAST_TITL2,
				  	PI2.INFO_MAST_SUBT1,
				  	PI2.INFO_MAST_SUBT2,
				  	
				  	(SELECT COUNT(*) FROM PPM_USER_FOLL PUF WHERE CATE_IDX = PC.CATE_IDX AND PUF.FOLL_USE_YN = 'Y' ) FOLLOW,
				  	(SELECT COUNT(*) FROM PPM_USER_BUY WHERE CATE_IDX = PC.CATE_IDX AND BUY_REFU_YN = 'N' AND BUY_PRDT_CD LIKE '%VN%') LECT_CNT,
				  	(SELECT COUNT(*) FROM PPM_USER_BUY WHERE CATE_IDX = PC.CATE_IDX AND BUY_REFU_YN = 'N' AND BUY_PRDT_CD LIKE '%FN%') FACE_CNT,
				  	(SELECT COUNT(*) FROM PPM_USER_BUY WHERE CATE_IDX = PC.CATE_IDX AND BUY_REFU_YN = 'N' AND BUY_PRDT_CD LIKE '%CN%') CHAT_CNT
				  	
				FROM
				   PPM_USER PU, PPM_CATE PC, PPM_INFO PI2 
				WHERE
					PC.CATE_IDX = #{cateIdx}
					AND PU.USER_IDX = PC.USER_IDX 
					AND USER_USE_YN = 'Y'
					
	]]>
	<if test="cateUseYn in {'', null} ">
	<![CDATA[
					AND PC.CATE_USE_YN ='Y'
	]]>
	</if>
	<![CDATA[

					AND PI2.CATE_IDX = PC.CATE_IDX
					AND PI2.INFO_ORDE = 0
					AND PI2.INFO_USE_YN = 'Y'
		
		]]>
	</select>
	
	<insert id="insertFrontFollowDataDuple" parameterType="hashmap">
		<selectKey resultType="hashmap" keyProperty="haveDataYn, FOLL_IDX" order="BEFORE">
		<![CDATA[
			SELECT 
				CASE WHEN  COUNT(0) > 0 THEN 'Y' ELSE 'N' END AS haveDataYn, 
				FOLL_IDX 
				FROM PPM_USER_FOLL 
					WHERE
						CATE_IDX = #{cateIdx}
						AND USER_IDX = #{frontLoginIdx}
		]]>	
		<choose >
			<when test="prdtCd not in {null, ''}">
		<![CDATA[
						AND PRDT_CD = #{prdtCd}
		]]>	
			</when>
			<otherwise>
		<![CDATA[
						AND PRDT_CD IS NULL
		]]>
			</otherwise>
		</choose>
		<![CDATA[
						AND FOLL_USE_YN = 'Y'
		]]>	
		</selectKey>
		<choose>
			<when test='haveDataYn == "N"'>
					<![CDATA[
						
						INSERT 
							INTO PPM_DEV.PPM_USER_FOLL
							(
							CATE_IDX, 
							USER_IDX,
							PRDT_CD, 
							FOLL_USE_YN,
							SYS_REG_IDX,
							SYS_REG_DTM,
							SYS_MOD_IDX,
							SYS_MOD_DTM
							)
						
							VALUES
							(
							#{cateIdx}, 
							#{frontLoginIdx}, 
							#{prdtCd}, 
							'Y',
							#{frontLoginIdx},
							DATE_FORMAT(NOW(), '%Y-%m-%d %H:%i:%S'),
							#{frontLoginIdx},
							DATE_FORMAT(NOW(), '%Y-%m-%d %H:%i:%S')
							)
						
					]]>
			
			</when>
			<otherwise>
					<![CDATA[
						
						UPDATE  PPM_DEV.PPM_USER_FOLL
							SET
							PRDT_CD = #{prdtCd},
							FOLL_USE_YN = #{follUseYn},
							SYS_MOD_IDX = #{frontLoginIdx},
							SYS_MOD_DTM = DATE_FORMAT(NOW(), '%Y-%m-%d %H:%i:%S')
							
							WHERE
							 	CATE_IDX = #{cateIdx}
								AND USER_IDX = #{frontLoginIdx}
					]]>
			
			</otherwise>
		</choose>
	</insert>


	<select id="selectFrontReviewListCnt" parameterType="hashmap" resultType="java.lang.Integer">
	<![CDATA[
SELECT COUNT(0) 
	FROM (			
	
	
	SELECT 
		PUR.REVI_IDX ,
		PUR.BUY_IDX,
		PUR.USER_IDX,
		PU.USER_NICK,
		PU.USER_NM,
		REVI_SCOR,
		REVI_CNTN,
		REVI_PUBL_YN,
		
		PUB.BUY_PRDT_CD,
		PRDT.PRDT_NM,
		PRDT.PRDT_TYPE,
		
		DATE_FORMAT(PUR.SYS_REG_DTM, '%Y-%m-%d') SYS_REG_DTM,
		
		(SELECT COUNT(0) FROM PPM_PRDT_BASK PPB WHERE PPB.BASK_TYPE = 'K' AND PPB.CATE_IDX = PUR.CATE_IDX AND PUB.BUY_IDX = PPB.BASK_IDX   ) JJIMCNT
		
		FROM 
			PPM_USER_REVI PUR,
			PPM_USER PU,
			PPM_USER_BUY PUB,
			(
							SELECT '1:1화상상담' AS PRDT_TYPE, PSF.CATE_IDX, PSF.FACE_IDX AS PRDT_IDX, PPF.FACE_CD AS PRDT_CD, (SELECT CONCAT(PIP.INFO_PRDT_TITL1, ' ', PIP.INFO_PRDT_TITL2 ) FROM PPM_INFO_PRDT PIP  WHERE  PIP.PRDT_CD = CONCAT( 'COACHING', PPF.CATE_IDX ) AND PIP.INFO_ORDE = 0 AND PIP.INFO_USE_YN = 'Y') AS PRDT_NM, FACE_PRIC_REAL AS PRDT_PRIC_REAL, FACE_IMG_UUID AS PRDT_UUID, 'FACE_IMG_UUID' AS PRDT_UUID_NM
								FROM PPM_SALE_FACE PSF, PPM_PRDT_FACE PPF WHERE SALE_USE_YN = 'Y' AND PSF.FACE_IDX = PPF.FACE_IDX
							UNION ALL
								SELECT 'VOD' AS PRDT_TYPE, PSLE.CATE_IDX, PSLE.LECT_IDX AS PRDT_IDX, PPLE.LECT_CD AS PRDT_CD,(SELECT CONCAT(PIP.INFO_PRDT_TITL1, ' ', PIP.INFO_PRDT_TITL2 ) FROM PPM_INFO_PRDT PIP  WHERE  PIP.PRDT_CD = PPLE.LECT_CD AND PIP.INFO_ORDE = 0 AND PIP.INFO_USE_YN = 'Y') AS PRDT_NM, LECT_PRIC_REAL AS PRDT_PRIC_REAL, LECT_UUID AS PRDT_UUID, 'LECT_UUID' AS PRDT_UUID_NM
								FROM PPM_SALE_LECT PSLE, PPM_PRDT_LECT PPLE WHERE SALE_USE_YN = 'Y' AND PPLE.LECT_USE_YN = 'Y' AND PSLE.LECT_IDX = PPLE.LECT_IDX
							UNION ALL
								SELECT '1:1채팅상담' AS PRDT_TYPE, PSC.CATE_IDX, PSC.CHAT_IDX AS PRDT_IDX, PPC.CHAT_CD AS PRDT_CD, (SELECT CONCAT(PIP.INFO_PRDT_TITL1, ' ', PIP.INFO_PRDT_TITL2 ) FROM PPM_INFO_PRDT PIP  WHERE  PIP.PRDT_CD = CONCAT( 'COACHING', PPC.CATE_IDX ) AND PIP.INFO_ORDE = 0 AND PIP.INFO_USE_YN = 'Y') AS PRDT_NM, CHAT_PRIC_REAL AS PRDT_PRIC_REAL, CHAT_IMG_UUID AS PRDT_UUID, 'CHAT_IMG_UUID' AS PRDT_UUID_NM
								FROM PPM_SALE_CHAT PSC, PPM_PRDT_CHAT PPC WHERE SALE_USE_YN = 'Y' AND PSC.CHAT_IDX = PPC.CHAT_IDX
							UNION ALL
								SELECT '1:1이메일상담' AS PRDT_TYPE, PSM.CATE_IDX, PSM.MAIL_IDX AS PRDT_IDX, PPM.MAIL_CD AS PRDT_CD, (SELECT CONCAT(PIP.INFO_PRDT_TITL1, ' ', PIP.INFO_PRDT_TITL2 ) FROM PPM_INFO_PRDT PIP  WHERE  PIP.PRDT_CD = CONCAT( 'COACHING', PPM.CATE_IDX ) AND PIP.INFO_ORDE = 0 AND PIP.INFO_USE_YN = 'Y') AS PRDT_NM, MAIL_PRIC_REAL AS PRDT_PRIC_REAL, MAIL_IMG_UUID AS PRDT_UUID, 'MAIL_IMG_UUID' AS PRDT_UUID_NM
								FROM PPM_SALE_MAIL PSM, PPM_PRDT_MAIL PPM WHERE SALE_USE_YN = 'Y' AND PSM.MAIL_IDX = PPM.MAIL_IDX
							UNION ALL
								SELECT '라이브클래스' AS PRDT_TYPE, PSLI.CATE_IDX, PSLI.LIVE_IDX AS PRDT_IDX, PPLI.LIVE_CD AS PRDT_CD, (SELECT CONCAT(PIP.INFO_PRDT_TITL1, ' ', PIP.INFO_PRDT_TITL2 ) FROM PPM_INFO_PRDT PIP  WHERE  PIP.PRDT_CD = PPLI.LIVE_CD AND PIP.INFO_ORDE = 0 AND PIP.INFO_USE_YN = 'Y') AS PRDT_NM, LIVE_PRIC_REAL AS PRDT_PRIC_REAL, LIVE_IMG_UUID AS PRDT_UUID, 'LIVE_IMG_UUID' AS PRDT_UUID_NM
								FROM PPM_SALE_LIVE PSLI, PPM_PRDT_LIVE PPLI WHERE SALE_USE_YN = 'Y' AND PSLI.LIVE_IDX = PPLI.LIVE_IDX
			) PRDT
		
			WHERE PUR.CATE_IDX = #{cateIdx}
				AND PU.USER_IDX = PUR.USER_IDX 
				AND PUB.BUY_IDX = PUR.BUY_IDX
				AND PUB.BUY_PRDT_CD = PRDT.PRDT_CD
				AND PUR.REVI_USE_YN = 'Y'
			
			
	) A	
	]]>
	</select>
	
	<select id="selectFrontReviewList" parameterType="hashmap" resultType="hashmap">
	<if test=" page not in {'', null} ">
	<![CDATA[
SELECT C.* FROM (
	SELECT B.*, (@rownumB:=@rownumB+1) as NUM_ASC FROM(  
		SELECT A.*, (@rownumA:=@rownumA+1) as NUM_DESC FROM (
	]]>
	</if>
	<![CDATA[
			
	SELECT 
		PUR.REVI_IDX ,
		PUR.BUY_IDX,
		PUR.USER_IDX,
		PU.USER_NICK,
		PU.USER_NM,
		REVI_SCOR,
		REVI_CNTN,
		REVI_PUBL_YN,
		
		PUB.BUY_PRDT_CD,
		PRDT.PRDT_NM,
		PRDT.PRDT_TYPE,
		
		DATE_FORMAT(PUR.SYS_REG_DTM, '%Y-%m-%d') SYS_REG_DTM,
		
		(SELECT COUNT(0) FROM PPM_PRDT_BASK PPB WHERE PPB.BASK_TYPE = 'K' AND PPB.CATE_IDX = PUR.CATE_IDX AND PUB.BUY_IDX = PPB.BASK_IDX   ) JJIMCNT
		
		FROM 
			PPM_USER_REVI PUR,
			PPM_USER PU,
			PPM_USER_BUY PUB,
			(
							SELECT '1:1화상상담' AS PRDT_TYPE, PSF.CATE_IDX, PSF.FACE_IDX AS PRDT_IDX, PPF.FACE_CD AS PRDT_CD, (SELECT CONCAT(PIP.INFO_PRDT_TITL1, ' ', PIP.INFO_PRDT_TITL2 ) FROM PPM_INFO_PRDT PIP  WHERE  PIP.PRDT_CD = CONCAT( 'COACHING', PPF.CATE_IDX ) AND PIP.INFO_ORDE = 0 AND PIP.INFO_USE_YN = 'Y') AS PRDT_NM, FACE_PRIC_REAL AS PRDT_PRIC_REAL, FACE_IMG_UUID AS PRDT_UUID, 'FACE_IMG_UUID' AS PRDT_UUID_NM
								FROM PPM_SALE_FACE PSF, PPM_PRDT_FACE PPF WHERE SALE_USE_YN = 'Y' AND PSF.FACE_IDX = PPF.FACE_IDX
							UNION ALL
								SELECT 'VOD' AS PRDT_TYPE, PSLE.CATE_IDX, PSLE.LECT_IDX AS PRDT_IDX, PPLE.LECT_CD AS PRDT_CD,(SELECT CONCAT(PIP.INFO_PRDT_TITL1, ' ', PIP.INFO_PRDT_TITL2 ) FROM PPM_INFO_PRDT PIP  WHERE  PIP.PRDT_CD = PPLE.LECT_CD AND PIP.INFO_ORDE = 0 AND PIP.INFO_USE_YN = 'Y') AS PRDT_NM, LECT_PRIC_REAL AS PRDT_PRIC_REAL, LECT_UUID AS PRDT_UUID, 'LECT_UUID' AS PRDT_UUID_NM
								FROM PPM_SALE_LECT PSLE, PPM_PRDT_LECT PPLE WHERE SALE_USE_YN = 'Y' AND PPLE.LECT_USE_YN = 'Y' AND PSLE.LECT_IDX = PPLE.LECT_IDX
							UNION ALL
								SELECT '1:1채팅상담' AS PRDT_TYPE, PSC.CATE_IDX, PSC.CHAT_IDX AS PRDT_IDX, PPC.CHAT_CD AS PRDT_CD, (SELECT CONCAT(PIP.INFO_PRDT_TITL1, ' ', PIP.INFO_PRDT_TITL2 ) FROM PPM_INFO_PRDT PIP  WHERE  PIP.PRDT_CD = CONCAT( 'COACHING', PPC.CATE_IDX ) AND PIP.INFO_ORDE = 0 AND PIP.INFO_USE_YN = 'Y') AS PRDT_NM, CHAT_PRIC_REAL AS PRDT_PRIC_REAL, CHAT_IMG_UUID AS PRDT_UUID, 'CHAT_IMG_UUID' AS PRDT_UUID_NM
								FROM PPM_SALE_CHAT PSC, PPM_PRDT_CHAT PPC WHERE SALE_USE_YN = 'Y' AND PSC.CHAT_IDX = PPC.CHAT_IDX
							UNION ALL
								SELECT '1:1이메일상담' AS PRDT_TYPE, PSM.CATE_IDX, PSM.MAIL_IDX AS PRDT_IDX, PPM.MAIL_CD AS PRDT_CD, (SELECT CONCAT(PIP.INFO_PRDT_TITL1, ' ', PIP.INFO_PRDT_TITL2 ) FROM PPM_INFO_PRDT PIP  WHERE  PIP.PRDT_CD = CONCAT( 'COACHING', PPM.CATE_IDX ) AND PIP.INFO_ORDE = 0 AND PIP.INFO_USE_YN = 'Y') AS PRDT_NM, MAIL_PRIC_REAL AS PRDT_PRIC_REAL, MAIL_IMG_UUID AS PRDT_UUID, 'MAIL_IMG_UUID' AS PRDT_UUID_NM
								FROM PPM_SALE_MAIL PSM, PPM_PRDT_MAIL PPM WHERE SALE_USE_YN = 'Y' AND PSM.MAIL_IDX = PPM.MAIL_IDX
							UNION ALL
								SELECT '라이브클래스' AS PRDT_TYPE, PSLI.CATE_IDX, PSLI.LIVE_IDX AS PRDT_IDX, PPLI.LIVE_CD AS PRDT_CD, (SELECT CONCAT(PIP.INFO_PRDT_TITL1, ' ', PIP.INFO_PRDT_TITL2 ) FROM PPM_INFO_PRDT PIP  WHERE  PIP.PRDT_CD = PPLI.LIVE_CD AND PIP.INFO_ORDE = 0 AND PIP.INFO_USE_YN = 'Y') AS PRDT_NM, LIVE_PRIC_REAL AS PRDT_PRIC_REAL, LIVE_IMG_UUID AS PRDT_UUID, 'LIVE_IMG_UUID' AS PRDT_UUID_NM
								FROM PPM_SALE_LIVE PSLI, PPM_PRDT_LIVE PPLI WHERE SALE_USE_YN = 'Y' AND PSLI.LIVE_IDX = PPLI.LIVE_IDX
			) PRDT
		
			WHERE PUR.CATE_IDX = #{cateIdx}
				AND PU.USER_IDX = PUR.USER_IDX 
				AND PUB.BUY_IDX = PUR.BUY_IDX
				AND PUB.BUY_PRDT_CD = PRDT.PRDT_CD
				AND PUR.REVI_USE_YN = 'Y'
	]]>
	<if test='sort in { "", null}'>
	<![CDATA[		
				ORDER BY SYS_REG_DTM DESC	
	]]>
	</if>
	<if test='sort in {"star"}'>
	<![CDATA[		
				ORDER BY REVI_SCOR DESC	
	]]>
	</if>
	<if test='sort in {"popular"}'>
	<![CDATA[		
				ORDER BY JJIMCNT DESC	
	]]>
	</if>
	<if test=" page not in {'', null} ">
	<![CDATA[
			) A JOIN (SELECT @rownumA:=0) rownumA 
	]]>		
			<if test='sort in { "", null}'>
			<![CDATA[		
						ORDER BY SYS_REG_DTM ASC	
			]]>
			</if>
	
			<if test='sort in {"popular"}'>
			<![CDATA[		
						ORDER BY JJIMCNT ASC
			]]>
			</if>
			<if test='sort in {"star"}'>
			<![CDATA[		
						ORDER BY REVI_SCOR ASC	
			]]>
			</if>	
	<![CDATA[				
	) B JOIN (SELECT @rownumB:=0) rownumB ORDER BY NUM_DESC DESC
) C WHERE NUM_ASC BETWEEN #{startRow } AND #{endRow }
	]]>
	</if>
	</select>

	<insert id="insertFrontReviewRepot" parameterType="hashmap">
	<![CDATA[
		INSERT INTO PPM_USER_REVI_REPO
			(
			REVI_IDX, 
			USER_IDX, 
			REPO_CNTN,
			REPO_USE_YN, 
			SYS_REG_IDX, 
			SYS_REG_DTM, 
			SYS_MOD_IDX, 
			SYS_MOD_DTM
			)
			
			VALUES
			(
			#{reviIdx}, 
			#{frontLoginIdx}, 
			#{repoCntn}, 
			'Y', 
			#{frontLoginIdx}, 
			DATE_FORMAT(NOW(), '%Y-%m-%d %H:%i:%S'), 
			#{frontLoginIdx}, 
			DATE_FORMAT(NOW(), '%Y-%m-%d %H:%i:%S')
			)
		]]>
	</insert>
	
	<select id="selectFrontUserHaveReport" parameterType="hashmap" resultType="hashmap">
	<![CDATA[
			SELECT 
				COUNT(0) CNT
				FROM 
					PPM_USER_REVI_REPO PURR 
						WHERE 
							USER_IDX = #{userIdx}
							AND PURR.REVI_IDX = #{reviIdx}
							AND PURR.REPO_USE_YN = 'Y'
		]]>
	</select>
	
	<select id="selectFrontRecommendProductList" parameterType="hashmap" resultType="hashmap">
	
<![CDATA[

	select a.* from		
	(
	(				
					
		SELECT
				LIST.*,
				(
					CASE
						WHEN PRDT_CD LIKE '%COACH%'
						THEN IFNULL( (
							SELECT PPB.BASK_IDX FROM PPM_PRDT_BASK PPB
							WHERE PPB.CATE_IDX = SUBSTR(PRDT_CD,9,LENGTH(PRDT_CD) )
							AND PPB.BASK_USE_YN = 'Y' AND PPB.BASK_TYPE= 'K'
							AND PPB.USER_IDX = '110'
							AND ( PRDT_REG_CD LIKE '%CN%' OR PRDT_REG_CD LIKE '%FN%' OR PRDT_REG_CD LIKE '%EN%')
							AND ( BASK_PRDT_CD = PRDT_CD OR BASK_PRDT_CD = PRDT_REG_CD ) ), 'NOJJIM' )
						ELSE IFNULL( (SELECT PPB.BASK_IDX FROM PPM_PRDT_BASK PPB WHERE PPB.BASK_PRDT_CD = PRDT_CD AND PPB.BASK_USE_YN = 'Y' AND PPB.BASK_TYPE= 'K' AND PPB.USER_IDX = '110'), 'NOJJIM' )
					END
				) AS JJIM_IDX
			FROM (
				SELECT
					*
				FROM (
					SELECT DISTINCT
						PSCV.PRDT_CD AS PRDT_REG_CD,
						S_CODE.CODE_NM AS S_CODE_NM,
						DATE_FORMAT(PSCV.SYS_REG_DTM, '%Y-%m-%d') AS SYS_REG_DTM,
					
						PPV.*,
						PPV.PRDT_CD AS SALE_PRDT_CD,
						PC.CATE_ORDR,
						(
							CASE
								WHEN PPV.PRDT_CD LIKE '%VL%' THEN ( SELECT FORMAT( PRDT_PRIC, 0 ) FROM PPM_SALE_CD_VIEW WHERE PRDT_CD = PPV.PRDT_CD )
								WHEN PPV.PRDT_CD LIKE '%LN%' THEN ( SELECT FORMAT( PRDT_PRIC, 0 ) FROM PPM_SALE_CD_VIEW WHERE PRDT_CD = PPV.PRDT_CD )
								ELSE ( SELECT FORMAT( PRDT_PRIC, 0 ) FROM PPM_SALE_CD_VIEW WHERE CATE_IDX = REPLACE(PPV.PRDT_CD, 'COACHING', '') AND ( PRDT_CD NOT LIKE '%VL%' OR PRDT_CD NOT LIKE '%LN%' ) ORDER BY PRDT_PRIC_REAL LIMIT 1 )
							END
						) AS PRDT_PRIC,
						(
							CASE
								WHEN PPV.PRDT_CD LIKE '%VL%' THEN ( SELECT PRDT_DISC_CD FROM PPM_SALE_CD_VIEW WHERE PRDT_CD = PPV.PRDT_CD )
								WHEN PPV.PRDT_CD LIKE '%LN%' THEN ( SELECT PRDT_DISC_CD FROM PPM_SALE_CD_VIEW WHERE PRDT_CD = PPV.PRDT_CD )
								ELSE ( SELECT PRDT_DISC_CD FROM PPM_SALE_CD_VIEW WHERE CATE_IDX = REPLACE(PPV.PRDT_CD, 'COACHING', '') AND ( PRDT_CD NOT LIKE '%VL%' OR PRDT_CD NOT LIKE '%LN%' ) ORDER BY PRDT_PRIC_REAL LIMIT 1 )
							END
						) AS PRDT_DISC_CD,
						(
							CASE
								WHEN PPV.PRDT_CD LIKE '%VL%' THEN ( SELECT PRDT_DISC FROM PPM_SALE_CD_VIEW WHERE PRDT_CD = PPV.PRDT_CD )
								WHEN PPV.PRDT_CD LIKE '%LN%' THEN ( SELECT PRDT_DISC FROM PPM_SALE_CD_VIEW WHERE PRDT_CD = PPV.PRDT_CD )
								ELSE ( SELECT PRDT_DISC FROM PPM_SALE_CD_VIEW WHERE CATE_IDX = REPLACE(PPV.PRDT_CD, 'COACHING', '') AND ( PRDT_CD NOT LIKE '%VL%' OR PRDT_CD NOT LIKE '%LN%' ) ORDER BY PRDT_PRIC_REAL LIMIT 1 )
							END
						) AS PRDT_DISC,
						(
							CASE
								WHEN PPV.PRDT_CD LIKE '%VL%' THEN ( SELECT PRDT_PRIC_REAL FROM PPM_SALE_CD_VIEW WHERE PRDT_CD = PPV.PRDT_CD )
								WHEN PPV.PRDT_CD LIKE '%LN%' THEN ( SELECT PRDT_PRIC_REAL FROM PPM_SALE_CD_VIEW WHERE PRDT_CD = PPV.PRDT_CD )
								ELSE ( SELECT FORMAT( PRDT_PRIC_REAL, 0 ) FROM PPM_SALE_CD_VIEW WHERE CATE_IDX = REPLACE(PPV.PRDT_CD, 'COACHING', '') AND ( PRDT_CD NOT LIKE '%VL%' OR PRDT_CD NOT LIKE '%LN%' ) ORDER BY PRDT_PRIC_REAL LIMIT 1 )
							END
						) AS PRDT_PRIC_REAL,
						CONVERT ( GROUP_CONCAT(
					    	(SELECT COUNT(0) FROM PPM_PRDT_TIME
					    		WHERE
										(
											CHAT_IDX = PSCV.PRDT_IDX
											OR LIVE_IDX = PSCV.PRDT_IDX
											OR FACE_IDX = PSCV.PRDT_IDX
										)
										AND DATEDIFF(TIME_DTM, NOW()) >= 0
										AND TIME_USE_YN = 'Y'
										AND ( DATE_FORMAT(CONCAT( TIME_DTM, ' ' ,TIME_STR ), '%Y-%m-%d %H:%i') < DATE_FORMAT(NOW(), '%Y-%m-%d %H:%i') ) = 0 
									ORDER BY TIME_DTM, TIME_STR
					    	)
					    ORDER BY
						PSCV.PRDT_CD ASC SEPARATOR ',' ), CHAR ) AS TIME_CNT
					
					FROM
						PPM_PRDT_VIEW PPV
							LEFT JOIN PPM_CATE PC ON PPV.CATE_IDX = PC.CATE_IDX
							LEFT JOIN PPM_SALE_CD_VIEW PSCV
								ON PSCV.CATE_IDX = PPV.CATE_IDX
								AND PPV.PRDT_CD = ( CASE WHEN PSCV.PRDT_CD LIKE '%VL%' THEN PSCV.PRDT_CD WHEN PSCV.PRDT_CD LIKE '%LN%' THEN PSCV.PRDT_CD ELSE CONCAT('COACHING',PSCV.CATE_IDX) END )
							LEFT JOIN PPM_CODE S_CODE ON S_CODE.CODE_ID = PSCV.CHAT_STAT_CD
							
					WHERE
						PC.CATE_IDX IS NOT NULL
						AND PC.CATE_USE_YN = 'Y'
						AND PC.CATE_READ_YN = 'Y'
						AND PSCV.SYS_REG_DTM IS NOT NULL
						AND PRDT_TYPE LIKE '%VOD%'
				
					GROUP BY
						CATE_IDX
					ORDER BY
						PSCV.SYS_REG_DTM DESC
				) MAIN
				WHERE
					PRDT_PRIC IS NOT NULL
					
				UNION ALL
				
				SELECT
					*
				FROM (
					SELECT DISTINCT
						PSCV.PRDT_CD AS PRDT_REG_CD,
						S_CODE.CODE_NM AS S_CODE_NM,
						DATE_FORMAT(PSCV.SYS_REG_DTM, '%Y-%m-%d') AS SYS_REG_DTM,
					
						PPV.*,
						PPV.PRDT_CD AS SALE_PRDT_CD,
						PC.CATE_ORDR,
						(
							CASE
								WHEN PPV.PRDT_CD LIKE '%VL%' THEN ( SELECT FORMAT( PRDT_PRIC, 0 ) FROM PPM_SALE_CD_VIEW WHERE PRDT_CD = PPV.PRDT_CD )
								WHEN PPV.PRDT_CD LIKE '%LN%' THEN ( SELECT FORMAT( PRDT_PRIC, 0 ) FROM PPM_SALE_CD_VIEW WHERE PRDT_CD = PPV.PRDT_CD )
								ELSE ( SELECT FORMAT( PRDT_PRIC, 0 ) FROM PPM_SALE_CD_VIEW WHERE CATE_IDX = REPLACE(PPV.PRDT_CD, 'COACHING', '') AND ( PRDT_CD NOT LIKE '%VL%' OR PRDT_CD NOT LIKE '%LN%' ) ORDER BY PRDT_PRIC_REAL LIMIT 1 )
							END
						) AS PRDT_PRIC,
						(
							CASE
								WHEN PPV.PRDT_CD LIKE '%VL%' THEN ( SELECT PRDT_DISC_CD FROM PPM_SALE_CD_VIEW WHERE PRDT_CD = PPV.PRDT_CD )
								WHEN PPV.PRDT_CD LIKE '%LN%' THEN ( SELECT PRDT_DISC_CD FROM PPM_SALE_CD_VIEW WHERE PRDT_CD = PPV.PRDT_CD )
								ELSE ( SELECT PRDT_DISC_CD FROM PPM_SALE_CD_VIEW WHERE CATE_IDX = REPLACE(PPV.PRDT_CD, 'COACHING', '') AND ( PRDT_CD NOT LIKE '%VL%' OR PRDT_CD NOT LIKE '%LN%' ) ORDER BY PRDT_PRIC_REAL LIMIT 1 )
							END
						) AS PRDT_DISC_CD,
						(
							CASE
								WHEN PPV.PRDT_CD LIKE '%VL%' THEN ( SELECT PRDT_DISC FROM PPM_SALE_CD_VIEW WHERE PRDT_CD = PPV.PRDT_CD )
								WHEN PPV.PRDT_CD LIKE '%LN%' THEN ( SELECT PRDT_DISC FROM PPM_SALE_CD_VIEW WHERE PRDT_CD = PPV.PRDT_CD )
								ELSE ( SELECT PRDT_DISC FROM PPM_SALE_CD_VIEW WHERE CATE_IDX = REPLACE(PPV.PRDT_CD, 'COACHING', '') AND ( PRDT_CD NOT LIKE '%VL%' OR PRDT_CD NOT LIKE '%LN%' ) ORDER BY PRDT_PRIC_REAL LIMIT 1 )
							END
						) AS PRDT_DISC,
						(
							CASE
								WHEN PPV.PRDT_CD LIKE '%VL%' THEN ( SELECT PRDT_PRIC_REAL FROM PPM_SALE_CD_VIEW WHERE PRDT_CD = PPV.PRDT_CD )
								WHEN PPV.PRDT_CD LIKE '%LN%' THEN ( SELECT PRDT_PRIC_REAL FROM PPM_SALE_CD_VIEW WHERE PRDT_CD = PPV.PRDT_CD )
								ELSE ( SELECT FORMAT( PRDT_PRIC_REAL, 0 ) FROM PPM_SALE_CD_VIEW WHERE CATE_IDX = REPLACE(PPV.PRDT_CD, 'COACHING', '') AND ( PRDT_CD NOT LIKE '%VL%' OR PRDT_CD NOT LIKE '%LN%' ) ORDER BY PRDT_PRIC_REAL LIMIT 1 )
							END
						) AS PRDT_PRIC_REAL,
						CONVERT ( GROUP_CONCAT(
					    	(SELECT COUNT(0) FROM PPM_PRDT_TIME
					    		WHERE
										(
											CHAT_IDX = PSCV.PRDT_IDX
											OR LIVE_IDX = PSCV.PRDT_IDX
											OR FACE_IDX = PSCV.PRDT_IDX
										)
										AND DATEDIFF(TIME_DTM, NOW()) >= 0
										AND TIME_USE_YN = 'Y'
										AND ( DATE_FORMAT(CONCAT( TIME_DTM, ' ' ,TIME_STR ), '%Y-%m-%d %H:%i') < DATE_FORMAT(NOW(), '%Y-%m-%d %H:%i') ) = 0 
									ORDER BY TIME_DTM, TIME_STR
					    	)
					    ORDER BY
						PSCV.PRDT_CD ASC SEPARATOR ',' ), CHAR ) AS TIME_CNT
					
					FROM
						PPM_PRDT_VIEW PPV
							LEFT JOIN PPM_CATE PC ON PPV.CATE_IDX = PC.CATE_IDX
							LEFT JOIN PPM_SALE_CD_VIEW PSCV
								ON PSCV.CATE_IDX = PPV.CATE_IDX
								AND PPV.PRDT_CD = ( CASE WHEN PSCV.PRDT_CD LIKE '%VL%' THEN PSCV.PRDT_CD WHEN PSCV.PRDT_CD LIKE '%LN%' THEN PSCV.PRDT_CD ELSE CONCAT('COACHING',PSCV.CATE_IDX) END )
							LEFT JOIN PPM_CODE S_CODE ON S_CODE.CODE_ID = PSCV.CHAT_STAT_CD
							
					WHERE
						PC.CATE_IDX IS NOT NULL
						AND PC.CATE_USE_YN = 'Y'
						AND PC.CATE_READ_YN = 'Y'
						AND PSCV.SYS_REG_DTM IS NOT NULL
						AND PRDT_TYPE LIKE '%1:1%'
				
					GROUP BY
						CATE_IDX
					ORDER BY
						PSCV.SYS_REG_DTM DESC
				) MAIN
				WHERE
					PRDT_PRIC IS NOT NULL
					AND TIME_CNT NOT IN ( '0', '0,0', '0,0,0', '0,0,0,0', '0,0,0,0,0' ) OR PRDT_TYPE3 LIKE '%EN%'
				
				UNION ALL
				
				SELECT
					*
				FROM (
					SELECT DISTINCT
						PSCV.PRDT_CD AS PRDT_REG_CD,
						S_CODE.CODE_NM AS S_CODE_NM,
						DATE_FORMAT(PSCV.SYS_REG_DTM, '%Y-%m-%d') AS SYS_REG_DTM,
					
						PPV.*,
						PPV.PRDT_CD AS SALE_PRDT_CD,
						PC.CATE_ORDR,
						(
							CASE
								WHEN PPV.PRDT_CD LIKE '%VL%' THEN ( SELECT FORMAT( PRDT_PRIC, 0 ) FROM PPM_SALE_CD_VIEW WHERE PRDT_CD = PPV.PRDT_CD )
								WHEN PPV.PRDT_CD LIKE '%LN%' THEN ( SELECT FORMAT( PRDT_PRIC, 0 ) FROM PPM_SALE_CD_VIEW WHERE PRDT_CD = PPV.PRDT_CD )
								ELSE ( SELECT FORMAT( PRDT_PRIC, 0 ) FROM PPM_SALE_CD_VIEW WHERE CATE_IDX = REPLACE(PPV.PRDT_CD, 'COACHING', '') AND ( PRDT_CD NOT LIKE '%VL%' OR PRDT_CD NOT LIKE '%LN%' ) ORDER BY PRDT_PRIC_REAL LIMIT 1 )
							END
						) AS PRDT_PRIC,
						(
							CASE
								WHEN PPV.PRDT_CD LIKE '%VL%' THEN ( SELECT PRDT_DISC_CD FROM PPM_SALE_CD_VIEW WHERE PRDT_CD = PPV.PRDT_CD )
								WHEN PPV.PRDT_CD LIKE '%LN%' THEN ( SELECT PRDT_DISC_CD FROM PPM_SALE_CD_VIEW WHERE PRDT_CD = PPV.PRDT_CD )
								ELSE ( SELECT PRDT_DISC_CD FROM PPM_SALE_CD_VIEW WHERE CATE_IDX = REPLACE(PPV.PRDT_CD, 'COACHING', '') AND ( PRDT_CD NOT LIKE '%VL%' OR PRDT_CD NOT LIKE '%LN%' ) ORDER BY PRDT_PRIC_REAL LIMIT 1 )
							END
						) AS PRDT_DISC_CD,
						(
							CASE
								WHEN PPV.PRDT_CD LIKE '%VL%' THEN ( SELECT PRDT_DISC FROM PPM_SALE_CD_VIEW WHERE PRDT_CD = PPV.PRDT_CD )
								WHEN PPV.PRDT_CD LIKE '%LN%' THEN ( SELECT PRDT_DISC FROM PPM_SALE_CD_VIEW WHERE PRDT_CD = PPV.PRDT_CD )
								ELSE ( SELECT PRDT_DISC FROM PPM_SALE_CD_VIEW WHERE CATE_IDX = REPLACE(PPV.PRDT_CD, 'COACHING', '') AND ( PRDT_CD NOT LIKE '%VL%' OR PRDT_CD NOT LIKE '%LN%' ) ORDER BY PRDT_PRIC_REAL LIMIT 1 )
							END
						) AS PRDT_DISC,
						(
							CASE
								WHEN PPV.PRDT_CD LIKE '%VL%' THEN ( SELECT PRDT_PRIC_REAL FROM PPM_SALE_CD_VIEW WHERE PRDT_CD = PPV.PRDT_CD )
								WHEN PPV.PRDT_CD LIKE '%LN%' THEN ( SELECT PRDT_PRIC_REAL FROM PPM_SALE_CD_VIEW WHERE PRDT_CD = PPV.PRDT_CD )
								ELSE ( SELECT FORMAT( PRDT_PRIC_REAL, 0 ) FROM PPM_SALE_CD_VIEW WHERE CATE_IDX = REPLACE(PPV.PRDT_CD, 'COACHING', '') AND ( PRDT_CD NOT LIKE '%VL%' OR PRDT_CD NOT LIKE '%LN%' ) ORDER BY PRDT_PRIC_REAL LIMIT 1 )
							END
						) AS PRDT_PRIC_REAL,
						CONVERT ( GROUP_CONCAT(
					    	(SELECT COUNT(0) FROM PPM_PRDT_TIME
					    		WHERE
										(
											CHAT_IDX = PSCV.PRDT_IDX
											OR LIVE_IDX = PSCV.PRDT_IDX
											OR FACE_IDX = PSCV.PRDT_IDX
										)
										AND DATEDIFF(TIME_DTM, NOW()) >= 0
										AND TIME_USE_YN = 'Y'
										AND ( DATE_FORMAT(CONCAT( TIME_DTM, ' ' ,TIME_STR ), '%Y-%m-%d %H:%i') < DATE_FORMAT(NOW(), '%Y-%m-%d %H:%i') ) = 0 
									ORDER BY TIME_DTM, TIME_STR
					    	)
					    ORDER BY
						PSCV.PRDT_CD ASC SEPARATOR ',' ), CHAR ) AS TIME_CNT
					
					FROM
						PPM_PRDT_VIEW PPV
							LEFT JOIN PPM_CATE PC ON PPV.CATE_IDX = PC.CATE_IDX
							LEFT JOIN PPM_SALE_CD_VIEW PSCV
								ON PSCV.CATE_IDX = PPV.CATE_IDX
								AND PPV.PRDT_CD = ( CASE WHEN PSCV.PRDT_CD LIKE '%VL%' THEN PSCV.PRDT_CD WHEN PSCV.PRDT_CD LIKE '%LN%' THEN PSCV.PRDT_CD ELSE CONCAT('COACHING',PSCV.CATE_IDX) END )
							LEFT JOIN PPM_CODE S_CODE ON S_CODE.CODE_ID = PSCV.CHAT_STAT_CD
							
					WHERE
						PC.CATE_IDX IS NOT NULL
						AND PC.CATE_USE_YN = 'Y'
						AND PC.CATE_READ_YN = 'Y'
						AND PSCV.SYS_REG_DTM IS NOT NULL
						AND PRDT_TYPE LIKE '%LIVE%'
				
					GROUP BY
						CATE_IDX
					ORDER BY
						PSCV.SYS_REG_DTM DESC
				) MAIN
				WHERE
					PRDT_PRIC IS NOT NULL
					AND TIME_CNT NOT IN ( '0', '0,0', '0,0,0', '0,0,0,0', '0,0,0,0,0' )
			) LIST
			WHERE
				CATE_IDX IS NOT NULL
				
				AND PRDT_CD IN (SELECT DISTINCT PRDT_CD FROM PPM_USER_LOG PUL WHERE ( SYS_REG_IDX =  #{frontLoginIdx} OR CATE_IDX IN ( ${userCateLog} ) ) AND PRDT_CD IS NOT NULL )
			ORDER BY P_CODE_NM LIMIT 4
		) 
		UNION ALL
		(
		SELECT
				LIST.*,
				(
					CASE
						WHEN PRDT_CD LIKE '%COACH%'
						THEN IFNULL( (
							SELECT PPB.BASK_IDX FROM PPM_PRDT_BASK PPB
							WHERE PPB.CATE_IDX = SUBSTR(PRDT_CD,9,LENGTH(PRDT_CD) )
							AND PPB.BASK_USE_YN = 'Y' AND PPB.BASK_TYPE= 'K'
							AND PPB.USER_IDX = '110'
							AND ( PRDT_REG_CD LIKE '%CN%' OR PRDT_REG_CD LIKE '%FN%' OR PRDT_REG_CD LIKE '%EN%')
							AND ( BASK_PRDT_CD = PRDT_CD OR BASK_PRDT_CD = PRDT_REG_CD ) ), 'NOJJIM' )
						ELSE IFNULL( (SELECT PPB.BASK_IDX FROM PPM_PRDT_BASK PPB WHERE PPB.BASK_PRDT_CD = PRDT_CD AND PPB.BASK_USE_YN = 'Y' AND PPB.BASK_TYPE= 'K' AND PPB.USER_IDX = '110'), 'NOJJIM' )
					END
				) AS JJIM_IDX
			FROM (
				SELECT
					*
				FROM (
					SELECT DISTINCT
						PSCV.PRDT_CD AS PRDT_REG_CD,
						S_CODE.CODE_NM AS S_CODE_NM,
						DATE_FORMAT(PSCV.SYS_REG_DTM, '%Y-%m-%d') AS SYS_REG_DTM,
					
						PPV.*,
						PPV.PRDT_CD AS SALE_PRDT_CD,
						PC.CATE_ORDR,
						(
							CASE
								WHEN PPV.PRDT_CD LIKE '%VL%' THEN ( SELECT FORMAT( PRDT_PRIC, 0 ) FROM PPM_SALE_CD_VIEW WHERE PRDT_CD = PPV.PRDT_CD )
								WHEN PPV.PRDT_CD LIKE '%LN%' THEN ( SELECT FORMAT( PRDT_PRIC, 0 ) FROM PPM_SALE_CD_VIEW WHERE PRDT_CD = PPV.PRDT_CD )
								ELSE ( SELECT FORMAT( PRDT_PRIC, 0 ) FROM PPM_SALE_CD_VIEW WHERE CATE_IDX = REPLACE(PPV.PRDT_CD, 'COACHING', '') AND ( PRDT_CD NOT LIKE '%VL%' OR PRDT_CD NOT LIKE '%LN%' ) ORDER BY PRDT_PRIC_REAL LIMIT 1 )
							END
						) AS PRDT_PRIC,
						(
							CASE
								WHEN PPV.PRDT_CD LIKE '%VL%' THEN ( SELECT PRDT_DISC_CD FROM PPM_SALE_CD_VIEW WHERE PRDT_CD = PPV.PRDT_CD )
								WHEN PPV.PRDT_CD LIKE '%LN%' THEN ( SELECT PRDT_DISC_CD FROM PPM_SALE_CD_VIEW WHERE PRDT_CD = PPV.PRDT_CD )
								ELSE ( SELECT PRDT_DISC_CD FROM PPM_SALE_CD_VIEW WHERE CATE_IDX = REPLACE(PPV.PRDT_CD, 'COACHING', '') AND ( PRDT_CD NOT LIKE '%VL%' OR PRDT_CD NOT LIKE '%LN%' ) ORDER BY PRDT_PRIC_REAL LIMIT 1 )
							END
						) AS PRDT_DISC_CD,
						(
							CASE
								WHEN PPV.PRDT_CD LIKE '%VL%' THEN ( SELECT PRDT_DISC FROM PPM_SALE_CD_VIEW WHERE PRDT_CD = PPV.PRDT_CD )
								WHEN PPV.PRDT_CD LIKE '%LN%' THEN ( SELECT PRDT_DISC FROM PPM_SALE_CD_VIEW WHERE PRDT_CD = PPV.PRDT_CD )
								ELSE ( SELECT PRDT_DISC FROM PPM_SALE_CD_VIEW WHERE CATE_IDX = REPLACE(PPV.PRDT_CD, 'COACHING', '') AND ( PRDT_CD NOT LIKE '%VL%' OR PRDT_CD NOT LIKE '%LN%' ) ORDER BY PRDT_PRIC_REAL LIMIT 1 )
							END
						) AS PRDT_DISC,
						(
							CASE
								WHEN PPV.PRDT_CD LIKE '%VL%' THEN ( SELECT PRDT_PRIC_REAL FROM PPM_SALE_CD_VIEW WHERE PRDT_CD = PPV.PRDT_CD )
								WHEN PPV.PRDT_CD LIKE '%LN%' THEN ( SELECT PRDT_PRIC_REAL FROM PPM_SALE_CD_VIEW WHERE PRDT_CD = PPV.PRDT_CD )
								ELSE ( SELECT FORMAT( PRDT_PRIC_REAL, 0 ) FROM PPM_SALE_CD_VIEW WHERE CATE_IDX = REPLACE(PPV.PRDT_CD, 'COACHING', '') AND ( PRDT_CD NOT LIKE '%VL%' OR PRDT_CD NOT LIKE '%LN%' ) ORDER BY PRDT_PRIC_REAL LIMIT 1 )
							END
						) AS PRDT_PRIC_REAL,
						CONVERT ( GROUP_CONCAT(
					    	(SELECT COUNT(0) FROM PPM_PRDT_TIME
					    		WHERE
										(
											CHAT_IDX = PSCV.PRDT_IDX
											OR LIVE_IDX = PSCV.PRDT_IDX
											OR FACE_IDX = PSCV.PRDT_IDX
										)
										AND DATEDIFF(TIME_DTM, NOW()) >= 0
										AND TIME_USE_YN = 'Y'
										AND ( DATE_FORMAT(CONCAT( TIME_DTM, ' ' ,TIME_STR ), '%Y-%m-%d %H:%i') < DATE_FORMAT(NOW(), '%Y-%m-%d %H:%i') ) = 0 
									ORDER BY TIME_DTM, TIME_STR
					    	)
					    ORDER BY
						PSCV.PRDT_CD ASC SEPARATOR ',' ), CHAR ) AS TIME_CNT
					
					FROM
						PPM_PRDT_VIEW PPV
							LEFT JOIN PPM_CATE PC ON PPV.CATE_IDX = PC.CATE_IDX
							LEFT JOIN PPM_SALE_CD_VIEW PSCV
								ON PSCV.CATE_IDX = PPV.CATE_IDX
								AND PPV.PRDT_CD = ( CASE WHEN PSCV.PRDT_CD LIKE '%VL%' THEN PSCV.PRDT_CD WHEN PSCV.PRDT_CD LIKE '%LN%' THEN PSCV.PRDT_CD ELSE CONCAT('COACHING',PSCV.CATE_IDX) END )
							LEFT JOIN PPM_CODE S_CODE ON S_CODE.CODE_ID = PSCV.CHAT_STAT_CD
							
					WHERE
						PC.CATE_IDX IS NOT NULL
						AND PC.CATE_USE_YN = 'Y'
						AND PC.CATE_READ_YN = 'Y'
						AND PSCV.SYS_REG_DTM IS NOT NULL
						AND PRDT_TYPE LIKE '%VOD%'
				
					GROUP BY
						CATE_IDX
					ORDER BY
						PSCV.SYS_REG_DTM DESC
				) MAIN
				WHERE
					PRDT_PRIC IS NOT NULL
					
				UNION ALL
				
				SELECT
					*
				FROM (
					SELECT DISTINCT
						PSCV.PRDT_CD AS PRDT_REG_CD,
						S_CODE.CODE_NM AS S_CODE_NM,
						DATE_FORMAT(PSCV.SYS_REG_DTM, '%Y-%m-%d') AS SYS_REG_DTM,
					
						PPV.*,
						PPV.PRDT_CD AS SALE_PRDT_CD,
						PC.CATE_ORDR,
						(
							CASE
								WHEN PPV.PRDT_CD LIKE '%VL%' THEN ( SELECT FORMAT( PRDT_PRIC, 0 ) FROM PPM_SALE_CD_VIEW WHERE PRDT_CD = PPV.PRDT_CD )
								WHEN PPV.PRDT_CD LIKE '%LN%' THEN ( SELECT FORMAT( PRDT_PRIC, 0 ) FROM PPM_SALE_CD_VIEW WHERE PRDT_CD = PPV.PRDT_CD )
								ELSE ( SELECT FORMAT( PRDT_PRIC, 0 ) FROM PPM_SALE_CD_VIEW WHERE CATE_IDX = REPLACE(PPV.PRDT_CD, 'COACHING', '') AND ( PRDT_CD NOT LIKE '%VL%' OR PRDT_CD NOT LIKE '%LN%' ) ORDER BY PRDT_PRIC_REAL LIMIT 1 )
							END
						) AS PRDT_PRIC,
						(
							CASE
								WHEN PPV.PRDT_CD LIKE '%VL%' THEN ( SELECT PRDT_DISC_CD FROM PPM_SALE_CD_VIEW WHERE PRDT_CD = PPV.PRDT_CD )
								WHEN PPV.PRDT_CD LIKE '%LN%' THEN ( SELECT PRDT_DISC_CD FROM PPM_SALE_CD_VIEW WHERE PRDT_CD = PPV.PRDT_CD )
								ELSE ( SELECT PRDT_DISC_CD FROM PPM_SALE_CD_VIEW WHERE CATE_IDX = REPLACE(PPV.PRDT_CD, 'COACHING', '') AND ( PRDT_CD NOT LIKE '%VL%' OR PRDT_CD NOT LIKE '%LN%' ) ORDER BY PRDT_PRIC_REAL LIMIT 1 )
							END
						) AS PRDT_DISC_CD,
						(
							CASE
								WHEN PPV.PRDT_CD LIKE '%VL%' THEN ( SELECT PRDT_DISC FROM PPM_SALE_CD_VIEW WHERE PRDT_CD = PPV.PRDT_CD )
								WHEN PPV.PRDT_CD LIKE '%LN%' THEN ( SELECT PRDT_DISC FROM PPM_SALE_CD_VIEW WHERE PRDT_CD = PPV.PRDT_CD )
								ELSE ( SELECT PRDT_DISC FROM PPM_SALE_CD_VIEW WHERE CATE_IDX = REPLACE(PPV.PRDT_CD, 'COACHING', '') AND ( PRDT_CD NOT LIKE '%VL%' OR PRDT_CD NOT LIKE '%LN%' ) ORDER BY PRDT_PRIC_REAL LIMIT 1 )
							END
						) AS PRDT_DISC,
						(
							CASE
								WHEN PPV.PRDT_CD LIKE '%VL%' THEN ( SELECT PRDT_PRIC_REAL FROM PPM_SALE_CD_VIEW WHERE PRDT_CD = PPV.PRDT_CD )
								WHEN PPV.PRDT_CD LIKE '%LN%' THEN ( SELECT PRDT_PRIC_REAL FROM PPM_SALE_CD_VIEW WHERE PRDT_CD = PPV.PRDT_CD )
								ELSE ( SELECT FORMAT( PRDT_PRIC_REAL, 0 ) FROM PPM_SALE_CD_VIEW WHERE CATE_IDX = REPLACE(PPV.PRDT_CD, 'COACHING', '') AND ( PRDT_CD NOT LIKE '%VL%' OR PRDT_CD NOT LIKE '%LN%' ) ORDER BY PRDT_PRIC_REAL LIMIT 1 )
							END
						) AS PRDT_PRIC_REAL,
						CONVERT ( GROUP_CONCAT(
					    	(SELECT COUNT(0) FROM PPM_PRDT_TIME
					    		WHERE
										(
											CHAT_IDX = PSCV.PRDT_IDX
											OR LIVE_IDX = PSCV.PRDT_IDX
											OR FACE_IDX = PSCV.PRDT_IDX
										)
										AND DATEDIFF(TIME_DTM, NOW()) >= 0
										AND TIME_USE_YN = 'Y'
										AND ( DATE_FORMAT(CONCAT( TIME_DTM, ' ' ,TIME_STR ), '%Y-%m-%d %H:%i') < DATE_FORMAT(NOW(), '%Y-%m-%d %H:%i') ) = 0 
									ORDER BY TIME_DTM, TIME_STR
					    	)
					    ORDER BY
						PSCV.PRDT_CD ASC SEPARATOR ',' ), CHAR ) AS TIME_CNT
					
					FROM
						PPM_PRDT_VIEW PPV
							LEFT JOIN PPM_CATE PC ON PPV.CATE_IDX = PC.CATE_IDX
							LEFT JOIN PPM_SALE_CD_VIEW PSCV
								ON PSCV.CATE_IDX = PPV.CATE_IDX
								AND PPV.PRDT_CD = ( CASE WHEN PSCV.PRDT_CD LIKE '%VL%' THEN PSCV.PRDT_CD WHEN PSCV.PRDT_CD LIKE '%LN%' THEN PSCV.PRDT_CD ELSE CONCAT('COACHING',PSCV.CATE_IDX) END )
							LEFT JOIN PPM_CODE S_CODE ON S_CODE.CODE_ID = PSCV.CHAT_STAT_CD
							
					WHERE
						PC.CATE_IDX IS NOT NULL
						AND PC.CATE_USE_YN = 'Y'
						AND PC.CATE_READ_YN = 'Y'
						AND PSCV.SYS_REG_DTM IS NOT NULL
						AND PRDT_TYPE LIKE '%1:1%'
				
					GROUP BY
						CATE_IDX
					ORDER BY
						PSCV.SYS_REG_DTM DESC
				) MAIN
				WHERE
					PRDT_PRIC IS NOT NULL
					AND TIME_CNT NOT IN ( '0', '0,0', '0,0,0', '0,0,0,0', '0,0,0,0,0' ) OR PRDT_TYPE3 LIKE '%EN%'
				
				UNION ALL
				
				SELECT
					*
				FROM (
					SELECT DISTINCT
						PSCV.PRDT_CD AS PRDT_REG_CD,
						S_CODE.CODE_NM AS S_CODE_NM,
						DATE_FORMAT(PSCV.SYS_REG_DTM, '%Y-%m-%d') AS SYS_REG_DTM,
					
						PPV.*,
						PPV.PRDT_CD AS SALE_PRDT_CD,
						PC.CATE_ORDR,
						(
							CASE
								WHEN PPV.PRDT_CD LIKE '%VL%' THEN ( SELECT FORMAT( PRDT_PRIC, 0 ) FROM PPM_SALE_CD_VIEW WHERE PRDT_CD = PPV.PRDT_CD )
								WHEN PPV.PRDT_CD LIKE '%LN%' THEN ( SELECT FORMAT( PRDT_PRIC, 0 ) FROM PPM_SALE_CD_VIEW WHERE PRDT_CD = PPV.PRDT_CD )
								ELSE ( SELECT FORMAT( PRDT_PRIC, 0 ) FROM PPM_SALE_CD_VIEW WHERE CATE_IDX = REPLACE(PPV.PRDT_CD, 'COACHING', '') AND ( PRDT_CD NOT LIKE '%VL%' OR PRDT_CD NOT LIKE '%LN%' ) ORDER BY PRDT_PRIC_REAL LIMIT 1 )
							END
						) AS PRDT_PRIC,
						(
							CASE
								WHEN PPV.PRDT_CD LIKE '%VL%' THEN ( SELECT PRDT_DISC_CD FROM PPM_SALE_CD_VIEW WHERE PRDT_CD = PPV.PRDT_CD )
								WHEN PPV.PRDT_CD LIKE '%LN%' THEN ( SELECT PRDT_DISC_CD FROM PPM_SALE_CD_VIEW WHERE PRDT_CD = PPV.PRDT_CD )
								ELSE ( SELECT PRDT_DISC_CD FROM PPM_SALE_CD_VIEW WHERE CATE_IDX = REPLACE(PPV.PRDT_CD, 'COACHING', '') AND ( PRDT_CD NOT LIKE '%VL%' OR PRDT_CD NOT LIKE '%LN%' ) ORDER BY PRDT_PRIC_REAL LIMIT 1 )
							END
						) AS PRDT_DISC_CD,
						(
							CASE
								WHEN PPV.PRDT_CD LIKE '%VL%' THEN ( SELECT PRDT_DISC FROM PPM_SALE_CD_VIEW WHERE PRDT_CD = PPV.PRDT_CD )
								WHEN PPV.PRDT_CD LIKE '%LN%' THEN ( SELECT PRDT_DISC FROM PPM_SALE_CD_VIEW WHERE PRDT_CD = PPV.PRDT_CD )
								ELSE ( SELECT PRDT_DISC FROM PPM_SALE_CD_VIEW WHERE CATE_IDX = REPLACE(PPV.PRDT_CD, 'COACHING', '') AND ( PRDT_CD NOT LIKE '%VL%' OR PRDT_CD NOT LIKE '%LN%' ) ORDER BY PRDT_PRIC_REAL LIMIT 1 )
							END
						) AS PRDT_DISC,
						(
							CASE
								WHEN PPV.PRDT_CD LIKE '%VL%' THEN ( SELECT PRDT_PRIC_REAL FROM PPM_SALE_CD_VIEW WHERE PRDT_CD = PPV.PRDT_CD )
								WHEN PPV.PRDT_CD LIKE '%LN%' THEN ( SELECT PRDT_PRIC_REAL FROM PPM_SALE_CD_VIEW WHERE PRDT_CD = PPV.PRDT_CD )
								ELSE ( SELECT FORMAT( PRDT_PRIC_REAL, 0 ) FROM PPM_SALE_CD_VIEW WHERE CATE_IDX = REPLACE(PPV.PRDT_CD, 'COACHING', '') AND ( PRDT_CD NOT LIKE '%VL%' OR PRDT_CD NOT LIKE '%LN%' ) ORDER BY PRDT_PRIC_REAL LIMIT 1 )
							END
						) AS PRDT_PRIC_REAL,
						CONVERT ( GROUP_CONCAT(
					    	(SELECT COUNT(0) FROM PPM_PRDT_TIME
					    		WHERE
										(
											CHAT_IDX = PSCV.PRDT_IDX
											OR LIVE_IDX = PSCV.PRDT_IDX
											OR FACE_IDX = PSCV.PRDT_IDX
										)
										AND DATEDIFF(TIME_DTM, NOW()) >= 0
										AND TIME_USE_YN = 'Y'
										AND ( DATE_FORMAT(CONCAT( TIME_DTM, ' ' ,TIME_STR ), '%Y-%m-%d %H:%i') < DATE_FORMAT(NOW(), '%Y-%m-%d %H:%i') ) = 0 
									ORDER BY TIME_DTM, TIME_STR
					    	)
					    ORDER BY
						PSCV.PRDT_CD ASC SEPARATOR ',' ), CHAR ) AS TIME_CNT
					
					FROM
						PPM_PRDT_VIEW PPV
							LEFT JOIN PPM_CATE PC ON PPV.CATE_IDX = PC.CATE_IDX
							LEFT JOIN PPM_SALE_CD_VIEW PSCV
								ON PSCV.CATE_IDX = PPV.CATE_IDX
								AND PPV.PRDT_CD = ( CASE WHEN PSCV.PRDT_CD LIKE '%VL%' THEN PSCV.PRDT_CD WHEN PSCV.PRDT_CD LIKE '%LN%' THEN PSCV.PRDT_CD ELSE CONCAT('COACHING',PSCV.CATE_IDX) END )
							LEFT JOIN PPM_CODE S_CODE ON S_CODE.CODE_ID = PSCV.CHAT_STAT_CD
							
					WHERE
						PC.CATE_IDX IS NOT NULL
						AND PC.CATE_USE_YN = 'Y'
						AND PC.CATE_READ_YN = 'Y'
						AND PSCV.SYS_REG_DTM IS NOT NULL
						AND PRDT_TYPE LIKE '%LIVE%'
				
					GROUP BY
						CATE_IDX
					ORDER BY
						PSCV.SYS_REG_DTM DESC
				) MAIN
				WHERE
					PRDT_PRIC IS NOT NULL
					AND TIME_CNT NOT IN ( '0', '0,0', '0,0,0', '0,0,0,0', '0,0,0,0,0' )
			) LIST
			WHERE
				CATE_IDX IS NOT NULL
				
				AND CATE_IDX IN (
					SELECT DISTINCT CATE_IDX FROM PPM_USER PU, PPM_CATE PC
						WHERE
						  LENGTH(USER_KEYW) > 0
						  AND INSTR(PU.USER_KEYW,PC.CODE_ID) > 0
						  AND PC.CATE_USE_YN = 'Y'
						  AND PU.USER_IDX = #{frontLoginIdx}
				)
				
				
			ORDER BY P_CODE_NM LIMIT 4
			) 
			UNION ALL
			(
			SELECT
				LIST.*,
				(
					CASE
						WHEN PRDT_CD LIKE '%COACH%'
						THEN IFNULL( (
							SELECT PPB.BASK_IDX FROM PPM_PRDT_BASK PPB
							WHERE PPB.CATE_IDX = SUBSTR(PRDT_CD,9,LENGTH(PRDT_CD) )
							AND PPB.BASK_USE_YN = 'Y' AND PPB.BASK_TYPE= 'K'
							AND PPB.USER_IDX = '110'
							AND ( PRDT_REG_CD LIKE '%CN%' OR PRDT_REG_CD LIKE '%FN%' OR PRDT_REG_CD LIKE '%EN%')
							AND ( BASK_PRDT_CD = PRDT_CD OR BASK_PRDT_CD = PRDT_REG_CD ) ), 'NOJJIM' )
						ELSE IFNULL( (SELECT PPB.BASK_IDX FROM PPM_PRDT_BASK PPB WHERE PPB.BASK_PRDT_CD = PRDT_CD AND PPB.BASK_USE_YN = 'Y' AND PPB.BASK_TYPE= 'K' AND PPB.USER_IDX = '110'), 'NOJJIM' )
					END
				) AS JJIM_IDX
			FROM (
				SELECT
					*
				FROM (
					SELECT DISTINCT
						PSCV.PRDT_CD AS PRDT_REG_CD,
						S_CODE.CODE_NM AS S_CODE_NM,
						DATE_FORMAT(PSCV.SYS_REG_DTM, '%Y-%m-%d') AS SYS_REG_DTM,
					
						PPV.*,
						PPV.PRDT_CD AS SALE_PRDT_CD,
						PC.CATE_ORDR,
						(
							CASE
								WHEN PPV.PRDT_CD LIKE '%VL%' THEN ( SELECT FORMAT( PRDT_PRIC, 0 ) FROM PPM_SALE_CD_VIEW WHERE PRDT_CD = PPV.PRDT_CD )
								WHEN PPV.PRDT_CD LIKE '%LN%' THEN ( SELECT FORMAT( PRDT_PRIC, 0 ) FROM PPM_SALE_CD_VIEW WHERE PRDT_CD = PPV.PRDT_CD )
								ELSE ( SELECT FORMAT( PRDT_PRIC, 0 ) FROM PPM_SALE_CD_VIEW WHERE CATE_IDX = REPLACE(PPV.PRDT_CD, 'COACHING', '') AND ( PRDT_CD NOT LIKE '%VL%' OR PRDT_CD NOT LIKE '%LN%' ) ORDER BY PRDT_PRIC_REAL LIMIT 1 )
							END
						) AS PRDT_PRIC,
						(
							CASE
								WHEN PPV.PRDT_CD LIKE '%VL%' THEN ( SELECT PRDT_DISC_CD FROM PPM_SALE_CD_VIEW WHERE PRDT_CD = PPV.PRDT_CD )
								WHEN PPV.PRDT_CD LIKE '%LN%' THEN ( SELECT PRDT_DISC_CD FROM PPM_SALE_CD_VIEW WHERE PRDT_CD = PPV.PRDT_CD )
								ELSE ( SELECT PRDT_DISC_CD FROM PPM_SALE_CD_VIEW WHERE CATE_IDX = REPLACE(PPV.PRDT_CD, 'COACHING', '') AND ( PRDT_CD NOT LIKE '%VL%' OR PRDT_CD NOT LIKE '%LN%' ) ORDER BY PRDT_PRIC_REAL LIMIT 1 )
							END
						) AS PRDT_DISC_CD,
						(
							CASE
								WHEN PPV.PRDT_CD LIKE '%VL%' THEN ( SELECT PRDT_DISC FROM PPM_SALE_CD_VIEW WHERE PRDT_CD = PPV.PRDT_CD )
								WHEN PPV.PRDT_CD LIKE '%LN%' THEN ( SELECT PRDT_DISC FROM PPM_SALE_CD_VIEW WHERE PRDT_CD = PPV.PRDT_CD )
								ELSE ( SELECT PRDT_DISC FROM PPM_SALE_CD_VIEW WHERE CATE_IDX = REPLACE(PPV.PRDT_CD, 'COACHING', '') AND ( PRDT_CD NOT LIKE '%VL%' OR PRDT_CD NOT LIKE '%LN%' ) ORDER BY PRDT_PRIC_REAL LIMIT 1 )
							END
						) AS PRDT_DISC,
						(
							CASE
								WHEN PPV.PRDT_CD LIKE '%VL%' THEN ( SELECT PRDT_PRIC_REAL FROM PPM_SALE_CD_VIEW WHERE PRDT_CD = PPV.PRDT_CD )
								WHEN PPV.PRDT_CD LIKE '%LN%' THEN ( SELECT PRDT_PRIC_REAL FROM PPM_SALE_CD_VIEW WHERE PRDT_CD = PPV.PRDT_CD )
								ELSE ( SELECT FORMAT( PRDT_PRIC_REAL, 0 ) FROM PPM_SALE_CD_VIEW WHERE CATE_IDX = REPLACE(PPV.PRDT_CD, 'COACHING', '') AND ( PRDT_CD NOT LIKE '%VL%' OR PRDT_CD NOT LIKE '%LN%' ) ORDER BY PRDT_PRIC_REAL LIMIT 1 )
							END
						) AS PRDT_PRIC_REAL,
						CONVERT ( GROUP_CONCAT(
					    	(SELECT COUNT(0) FROM PPM_PRDT_TIME
					    		WHERE
										(
											CHAT_IDX = PSCV.PRDT_IDX
											OR LIVE_IDX = PSCV.PRDT_IDX
											OR FACE_IDX = PSCV.PRDT_IDX
										)
										AND DATEDIFF(TIME_DTM, NOW()) >= 0
										AND TIME_USE_YN = 'Y'
										AND ( DATE_FORMAT(CONCAT( TIME_DTM, ' ' ,TIME_STR ), '%Y-%m-%d %H:%i') < DATE_FORMAT(NOW(), '%Y-%m-%d %H:%i') ) = 0 
									ORDER BY TIME_DTM, TIME_STR
					    	)
					    ORDER BY
						PSCV.PRDT_CD ASC SEPARATOR ',' ), CHAR ) AS TIME_CNT
					
					FROM
						PPM_PRDT_VIEW PPV
							LEFT JOIN PPM_CATE PC ON PPV.CATE_IDX = PC.CATE_IDX
							LEFT JOIN PPM_SALE_CD_VIEW PSCV
								ON PSCV.CATE_IDX = PPV.CATE_IDX
								AND PPV.PRDT_CD = ( CASE WHEN PSCV.PRDT_CD LIKE '%VL%' THEN PSCV.PRDT_CD WHEN PSCV.PRDT_CD LIKE '%LN%' THEN PSCV.PRDT_CD ELSE CONCAT('COACHING',PSCV.CATE_IDX) END )
							LEFT JOIN PPM_CODE S_CODE ON S_CODE.CODE_ID = PSCV.CHAT_STAT_CD
							
					WHERE
						PC.CATE_IDX IS NOT NULL
						AND PC.CATE_USE_YN = 'Y'
						AND PC.CATE_READ_YN = 'Y'
						AND PSCV.SYS_REG_DTM IS NOT NULL
						AND PRDT_TYPE LIKE '%VOD%'
				
					GROUP BY
						CATE_IDX
					ORDER BY
						PSCV.SYS_REG_DTM DESC
				) MAIN
				WHERE
					PRDT_PRIC IS NOT NULL
					
				UNION ALL
				
				SELECT
					*
				FROM (
					SELECT DISTINCT
						PSCV.PRDT_CD AS PRDT_REG_CD,
						S_CODE.CODE_NM AS S_CODE_NM,
						DATE_FORMAT(PSCV.SYS_REG_DTM, '%Y-%m-%d') AS SYS_REG_DTM,
					
						PPV.*,
						PPV.PRDT_CD AS SALE_PRDT_CD,
						PC.CATE_ORDR,
						(
							CASE
								WHEN PPV.PRDT_CD LIKE '%VL%' THEN ( SELECT FORMAT( PRDT_PRIC, 0 ) FROM PPM_SALE_CD_VIEW WHERE PRDT_CD = PPV.PRDT_CD )
								WHEN PPV.PRDT_CD LIKE '%LN%' THEN ( SELECT FORMAT( PRDT_PRIC, 0 ) FROM PPM_SALE_CD_VIEW WHERE PRDT_CD = PPV.PRDT_CD )
								ELSE ( SELECT FORMAT( PRDT_PRIC, 0 ) FROM PPM_SALE_CD_VIEW WHERE CATE_IDX = REPLACE(PPV.PRDT_CD, 'COACHING', '') AND ( PRDT_CD NOT LIKE '%VL%' OR PRDT_CD NOT LIKE '%LN%' ) ORDER BY PRDT_PRIC_REAL LIMIT 1 )
							END
						) AS PRDT_PRIC,
						(
							CASE
								WHEN PPV.PRDT_CD LIKE '%VL%' THEN ( SELECT PRDT_DISC_CD FROM PPM_SALE_CD_VIEW WHERE PRDT_CD = PPV.PRDT_CD )
								WHEN PPV.PRDT_CD LIKE '%LN%' THEN ( SELECT PRDT_DISC_CD FROM PPM_SALE_CD_VIEW WHERE PRDT_CD = PPV.PRDT_CD )
								ELSE ( SELECT PRDT_DISC_CD FROM PPM_SALE_CD_VIEW WHERE CATE_IDX = REPLACE(PPV.PRDT_CD, 'COACHING', '') AND ( PRDT_CD NOT LIKE '%VL%' OR PRDT_CD NOT LIKE '%LN%' ) ORDER BY PRDT_PRIC_REAL LIMIT 1 )
							END
						) AS PRDT_DISC_CD,
						(
							CASE
								WHEN PPV.PRDT_CD LIKE '%VL%' THEN ( SELECT PRDT_DISC FROM PPM_SALE_CD_VIEW WHERE PRDT_CD = PPV.PRDT_CD )
								WHEN PPV.PRDT_CD LIKE '%LN%' THEN ( SELECT PRDT_DISC FROM PPM_SALE_CD_VIEW WHERE PRDT_CD = PPV.PRDT_CD )
								ELSE ( SELECT PRDT_DISC FROM PPM_SALE_CD_VIEW WHERE CATE_IDX = REPLACE(PPV.PRDT_CD, 'COACHING', '') AND ( PRDT_CD NOT LIKE '%VL%' OR PRDT_CD NOT LIKE '%LN%' ) ORDER BY PRDT_PRIC_REAL LIMIT 1 )
							END
						) AS PRDT_DISC,
						(
							CASE
								WHEN PPV.PRDT_CD LIKE '%VL%' THEN ( SELECT PRDT_PRIC_REAL FROM PPM_SALE_CD_VIEW WHERE PRDT_CD = PPV.PRDT_CD )
								WHEN PPV.PRDT_CD LIKE '%LN%' THEN ( SELECT PRDT_PRIC_REAL FROM PPM_SALE_CD_VIEW WHERE PRDT_CD = PPV.PRDT_CD )
								ELSE ( SELECT FORMAT( PRDT_PRIC_REAL, 0 ) FROM PPM_SALE_CD_VIEW WHERE CATE_IDX = REPLACE(PPV.PRDT_CD, 'COACHING', '') AND ( PRDT_CD NOT LIKE '%VL%' OR PRDT_CD NOT LIKE '%LN%' ) ORDER BY PRDT_PRIC_REAL LIMIT 1 )
							END
						) AS PRDT_PRIC_REAL,
						CONVERT ( GROUP_CONCAT(
					    	(SELECT COUNT(0) FROM PPM_PRDT_TIME
					    		WHERE
										(
											CHAT_IDX = PSCV.PRDT_IDX
											OR LIVE_IDX = PSCV.PRDT_IDX
											OR FACE_IDX = PSCV.PRDT_IDX
										)
										AND DATEDIFF(TIME_DTM, NOW()) >= 0
										AND TIME_USE_YN = 'Y'
										AND ( DATE_FORMAT(CONCAT( TIME_DTM, ' ' ,TIME_STR ), '%Y-%m-%d %H:%i') < DATE_FORMAT(NOW(), '%Y-%m-%d %H:%i') ) = 0 
									ORDER BY TIME_DTM, TIME_STR
					    	)
					    ORDER BY
						PSCV.PRDT_CD ASC SEPARATOR ',' ), CHAR ) AS TIME_CNT
					
					FROM
						PPM_PRDT_VIEW PPV
							LEFT JOIN PPM_CATE PC ON PPV.CATE_IDX = PC.CATE_IDX
							LEFT JOIN PPM_SALE_CD_VIEW PSCV
								ON PSCV.CATE_IDX = PPV.CATE_IDX
								AND PPV.PRDT_CD = ( CASE WHEN PSCV.PRDT_CD LIKE '%VL%' THEN PSCV.PRDT_CD WHEN PSCV.PRDT_CD LIKE '%LN%' THEN PSCV.PRDT_CD ELSE CONCAT('COACHING',PSCV.CATE_IDX) END )
							LEFT JOIN PPM_CODE S_CODE ON S_CODE.CODE_ID = PSCV.CHAT_STAT_CD
							
					WHERE
						PC.CATE_IDX IS NOT NULL
						AND PC.CATE_USE_YN = 'Y'
						AND PC.CATE_READ_YN = 'Y'
						AND PSCV.SYS_REG_DTM IS NOT NULL
						AND PRDT_TYPE LIKE '%1:1%'
				
					GROUP BY
						CATE_IDX
					ORDER BY
						PSCV.SYS_REG_DTM DESC
				) MAIN
				WHERE
					PRDT_PRIC IS NOT NULL
					AND TIME_CNT NOT IN ( '0', '0,0', '0,0,0', '0,0,0,0', '0,0,0,0,0' ) OR PRDT_TYPE3 LIKE '%EN%'
				
				UNION ALL
				
				SELECT
					*
				FROM (
					SELECT DISTINCT
						PSCV.PRDT_CD AS PRDT_REG_CD,
						S_CODE.CODE_NM AS S_CODE_NM,
						DATE_FORMAT(PSCV.SYS_REG_DTM, '%Y-%m-%d') AS SYS_REG_DTM,
					
						PPV.*,
						PPV.PRDT_CD AS SALE_PRDT_CD,
						PC.CATE_ORDR,
						(
							CASE
								WHEN PPV.PRDT_CD LIKE '%VL%' THEN ( SELECT FORMAT( PRDT_PRIC, 0 ) FROM PPM_SALE_CD_VIEW WHERE PRDT_CD = PPV.PRDT_CD )
								WHEN PPV.PRDT_CD LIKE '%LN%' THEN ( SELECT FORMAT( PRDT_PRIC, 0 ) FROM PPM_SALE_CD_VIEW WHERE PRDT_CD = PPV.PRDT_CD )
								ELSE ( SELECT FORMAT( PRDT_PRIC, 0 ) FROM PPM_SALE_CD_VIEW WHERE CATE_IDX = REPLACE(PPV.PRDT_CD, 'COACHING', '') AND ( PRDT_CD NOT LIKE '%VL%' OR PRDT_CD NOT LIKE '%LN%' ) ORDER BY PRDT_PRIC_REAL LIMIT 1 )
							END
						) AS PRDT_PRIC,
						(
							CASE
								WHEN PPV.PRDT_CD LIKE '%VL%' THEN ( SELECT PRDT_DISC_CD FROM PPM_SALE_CD_VIEW WHERE PRDT_CD = PPV.PRDT_CD )
								WHEN PPV.PRDT_CD LIKE '%LN%' THEN ( SELECT PRDT_DISC_CD FROM PPM_SALE_CD_VIEW WHERE PRDT_CD = PPV.PRDT_CD )
								ELSE ( SELECT PRDT_DISC_CD FROM PPM_SALE_CD_VIEW WHERE CATE_IDX = REPLACE(PPV.PRDT_CD, 'COACHING', '') AND ( PRDT_CD NOT LIKE '%VL%' OR PRDT_CD NOT LIKE '%LN%' ) ORDER BY PRDT_PRIC_REAL LIMIT 1 )
							END
						) AS PRDT_DISC_CD,
						(
							CASE
								WHEN PPV.PRDT_CD LIKE '%VL%' THEN ( SELECT PRDT_DISC FROM PPM_SALE_CD_VIEW WHERE PRDT_CD = PPV.PRDT_CD )
								WHEN PPV.PRDT_CD LIKE '%LN%' THEN ( SELECT PRDT_DISC FROM PPM_SALE_CD_VIEW WHERE PRDT_CD = PPV.PRDT_CD )
								ELSE ( SELECT PRDT_DISC FROM PPM_SALE_CD_VIEW WHERE CATE_IDX = REPLACE(PPV.PRDT_CD, 'COACHING', '') AND ( PRDT_CD NOT LIKE '%VL%' OR PRDT_CD NOT LIKE '%LN%' ) ORDER BY PRDT_PRIC_REAL LIMIT 1 )
							END
						) AS PRDT_DISC,
						(
							CASE
								WHEN PPV.PRDT_CD LIKE '%VL%' THEN ( SELECT PRDT_PRIC_REAL FROM PPM_SALE_CD_VIEW WHERE PRDT_CD = PPV.PRDT_CD )
								WHEN PPV.PRDT_CD LIKE '%LN%' THEN ( SELECT PRDT_PRIC_REAL FROM PPM_SALE_CD_VIEW WHERE PRDT_CD = PPV.PRDT_CD )
								ELSE ( SELECT FORMAT( PRDT_PRIC_REAL, 0 ) FROM PPM_SALE_CD_VIEW WHERE CATE_IDX = REPLACE(PPV.PRDT_CD, 'COACHING', '') AND ( PRDT_CD NOT LIKE '%VL%' OR PRDT_CD NOT LIKE '%LN%' ) ORDER BY PRDT_PRIC_REAL LIMIT 1 )
							END
						) AS PRDT_PRIC_REAL,
						CONVERT ( GROUP_CONCAT(
					    	(SELECT COUNT(0) FROM PPM_PRDT_TIME
					    		WHERE
										(
											CHAT_IDX = PSCV.PRDT_IDX
											OR LIVE_IDX = PSCV.PRDT_IDX
											OR FACE_IDX = PSCV.PRDT_IDX
										)
										AND DATEDIFF(TIME_DTM, NOW()) >= 0
										AND TIME_USE_YN = 'Y'
										AND ( DATE_FORMAT(CONCAT( TIME_DTM, ' ' ,TIME_STR ), '%Y-%m-%d %H:%i') < DATE_FORMAT(NOW(), '%Y-%m-%d %H:%i') ) = 0 
									ORDER BY TIME_DTM, TIME_STR
					    	)
					    ORDER BY
						PSCV.PRDT_CD ASC SEPARATOR ',' ), CHAR ) AS TIME_CNT
					
					FROM
						PPM_PRDT_VIEW PPV
							LEFT JOIN PPM_CATE PC ON PPV.CATE_IDX = PC.CATE_IDX
							LEFT JOIN PPM_SALE_CD_VIEW PSCV
								ON PSCV.CATE_IDX = PPV.CATE_IDX
								AND PPV.PRDT_CD = ( CASE WHEN PSCV.PRDT_CD LIKE '%VL%' THEN PSCV.PRDT_CD WHEN PSCV.PRDT_CD LIKE '%LN%' THEN PSCV.PRDT_CD ELSE CONCAT('COACHING',PSCV.CATE_IDX) END )
							LEFT JOIN PPM_CODE S_CODE ON S_CODE.CODE_ID = PSCV.CHAT_STAT_CD
							
					WHERE
						PC.CATE_IDX IS NOT NULL
						AND PC.CATE_USE_YN = 'Y'
						AND PC.CATE_READ_YN = 'Y'
						AND PSCV.SYS_REG_DTM IS NOT NULL
						AND PRDT_TYPE LIKE '%LIVE%'
				
					GROUP BY
						CATE_IDX
					ORDER BY
						PSCV.SYS_REG_DTM DESC
				) MAIN
				WHERE
					PRDT_PRIC IS NOT NULL
					AND TIME_CNT NOT IN ( '0', '0,0', '0,0,0', '0,0,0,0', '0,0,0,0,0' )
			) LIST
			WHERE
				CATE_IDX IS NOT NULL
				
				AND CATE_IDX IN 
					(
					SELECT CATE_IDX 
						FROM PPM_CATE PC 
						WHERE  
							PC.CODE_ID = (
								SELECT PC2.CODE_ID
									FROM 
										PPM_CATE PC2 
											WHERE PC2.CATE_IDX = #{cateIdx}
								)
							
							AND	CATE_USE_YN = 'Y'
							AND CATE_IDX !=  #{cateIdx}
					)
				
				
			ORDER BY P_CODE_NM 
			) 
		)A
		
		LIMIT 8
						

	
	]]>	
	</select>
	
	<insert id="insertFrontJjimDataDuple" parameterType="hashmap">
		<![CDATA[
			INSERT INTO 
				PPM_PRDT_BASK
				(
				BASK_PRDT_CD,
				USER_IDX,
				CATE_IDX, 
				BASK_TYPE, 
				BASK_USE_YN,
				BASK_CNT,
				SYS_REG_IDX, 
				SYS_REG_DTM,
				SYS_MOD_IDX,
				SYS_MOD_DTM
				)
				VALUES(
				#{baskPrdtCd}, 
				#{frontLoginIdx}, 
				#{cateIdx},
				#{baskType}, 
				'Y',
				#{baskCnt},
				#{frontLoginIdx}, 
				DATE_FORMAT( NOW(), '%Y-%m-%d %H:%i:%S' ),
				#{frontLoginIdx}, 
				DATE_FORMAT( NOW(), '%Y-%m-%d %H:%i:%S' )
				)
		]]>
	</insert>

	<update id="updateFrontJjimData" parameterType="hashmap">
		<![CDATA[
			UPDATE  
				PPM_PRDT_BASK
				SET
					BASK_USE_YN = #{baskUseYn},	
					BASK_CNT = #{baskCnt},
					SYS_MOD_IDX = #{frontLoginIdx},
					SYS_MOD_DTM = DATE_FORMAT( NOW(), '%Y-%m-%d %H:%i:%S' )
					WHERE
						BASK_PRDT_CD = #{baskPrdtCd}
						AND CATE_IDX = #{cateIdx}
						AND USER_IDX = #{frontLoginIdx}
						AND BASK_TYPE = #{baskType}
						AND SYS_REG_IDX = #{frontLoginIdx}
		
		]]>
	</update>
	
	<select id="selectFrontPrdtDataList" parameterType="hashmap" resultType="hashmap">
	<![CDATA[
		SELECT DISTINCT 
			PRDT.* ,
			IFNULL( (SELECT BASK_IDX FROM PPM_PRDT_BASK WHERE BASK_TYPE = 'K' AND BASK_USE_YN = 'Y' AND USER_IDX = #{frontLoginIdx} AND PPM_PRDT_BASK.BASK_PRDT_CD = PRDT.PRDT_CD2), 0 ) BASK_IDX,
			(
				SELECT
					COUNT(0)
				FROM	
					PPM_PRDT_TIME
				WHERE
					(
						CHAT_IDX = ( SELECT CHAT_IDX FROM PPM_PRDT_CHAT WHERE CHAT_CD = PRDT.PRDT_CD2 )
						OR LIVE_IDX = ( SELECT LIVE_IDX FROM PPM_PRDT_LIVE WHERE LIVE_CD = PRDT.PRDT_CD2 )
						OR FACE_IDX = ( SELECT FACE_IDX FROM PPM_PRDT_FACE WHERE FACE_CD = PRDT.PRDT_CD2 )
					)
					AND DATEDIFF(TIME_DTM, NOW()) >= 0
					AND TIME_USE_YN = 'Y'
					AND ( DATE_FORMAT(CONCAT( TIME_DTM, ' ' ,TIME_STR ), '%Y-%m-%d %H:%i') < DATE_FORMAT(NOW(), '%Y-%m-%d %H:%i') ) = 0 
				ORDER BY TIME_DTM, TIME_STR
			) AS TIME_CNT,
			(
				SELECT GROUP_CONCAT( SUBSTR(PRDT_CD,7,2) )
				FROM PPM_INFO_PRDT PIP WHERE PIP.CATE_IDX = PRDT.CATE_IDX AND PIP.PRDT_CD LIKE '%VL%' AND PIP.INFO_CD = 'PIN01'
			) AS PRDT_VL_CHK

		FROM 
			(
						SELECT '2' AS PRDT_NUM, '1:1화상상담' AS PRDT_TYPE, PSF.CATE_IDX, PSF.FACE_IDX AS PRDT_IDX, (SELECT PPT.TIME_RUN FROM PPM_PRDT_TIME PPT WHERE PPT.FACE_IDX = PPF.FACE_IDX AND PPT.TIME_USE_YN = 'Y' ORDER BY PPT.TIME_IDX DESC LIMIT 1) AS PRDT_TIME, CONCAT( 'COACHING', PPF.CATE_IDX ) AS PRDT_CD, PPF.FACE_CD AS PRDT_CD2, (SELECT PIP.INFO_PRDT_TITL1 FROM PPM_INFO_PRDT PIP  WHERE  PIP.PRDT_CD = CONCAT( 'COACHING', PPF.CATE_IDX ) AND PIP.INFO_ORDE = 0 AND PIP.INFO_USE_YN = 'Y') AS PRDT_NM1, (SELECT PIP.INFO_PRDT_TITL2 FROM PPM_INFO_PRDT PIP  WHERE  PIP.PRDT_CD = CONCAT( 'COACHING', PPF.CATE_IDX ) AND PIP.INFO_ORDE = 0 AND PIP.INFO_USE_YN = 'Y') AS PRDT_NM2, FACE_PRIC_REAL AS PRDT_PRIC_REAL, FACE_PRIC AS PRDT_PRIC , FACE_IMG_UUID AS PRDT_UUID, 'FACE_IMG_UUID' AS PRDT_UUID_NM
						FROM PPM_SALE_FACE PSF, PPM_PRDT_FACE PPF WHERE SALE_USE_YN = 'Y' AND PSF.FACE_IDX = PPF.FACE_IDX AND PPF.FACE_USE_YN = 'Y' AND PPF.FACE_STAT_CD = 'SAL02'
				UNION ALL
						SELECT '1' AS PRDT_NUM, 'VOD' AS PRDT_TYPE, PSLE.CATE_IDX, PSLE.LECT_IDX AS PRDT_IDX, PPLE.LECT_DTM AS PRDT_TIME, PPLE.LECT_CD AS PRDT_CD, PPLE.LECT_CD AS PRDT_CD2, (SELECT PIP.INFO_PRDT_TITL1 FROM PPM_INFO_PRDT PIP  WHERE  PIP.PRDT_CD = PPLE.LECT_CD AND PIP.INFO_ORDE = 0 AND PIP.INFO_USE_YN = 'Y') AS PRDT_NM1, (SELECT PIP.INFO_PRDT_TITL2 FROM PPM_INFO_PRDT PIP  WHERE  PIP.PRDT_CD = PPLE.LECT_CD AND PIP.INFO_ORDE = 0 AND PIP.INFO_USE_YN = 'Y') AS PRDT_NM2, LECT_PRIC_REAL AS PRDT_PRIC_REAL, LECT_PRIC AS PRDT_PRIC, LECT_UUID AS PRDT_UUID, 'LECT_UUID' AS PRDT_UUID_NM
						FROM PPM_SALE_LECT PSLE, PPM_PRDT_LECT PPLE WHERE SALE_USE_YN = 'Y' AND PPLE.LECT_USE_YN = 'Y' AND PSLE.LECT_IDX = PPLE.LECT_IDX AND PPLE.LECT_USE_YN = 'Y' AND PPLE.LECT_STAT_CD = 'SAL02'
				UNION ALL
						SELECT '2' AS PRDT_NUM, '1:1채팅상담' AS PRDT_TYPE, PSC.CATE_IDX, PSC.CHAT_IDX AS PRDT_IDX, (SELECT PPT.TIME_RUN FROM PPM_PRDT_TIME PPT WHERE PPT.CHAT_IDX = PPC.CHAT_IDX AND PPT.TIME_USE_YN = 'Y' ORDER BY PPT.TIME_IDX DESC LIMIT 1) AS PRDT_TIME, CONCAT( 'COACHING', PPC.CATE_IDX ) AS PRDT_CD, PPC.CHAT_CD AS PRDT_CD2, (SELECT PIP.INFO_PRDT_TITL1 FROM PPM_INFO_PRDT PIP  WHERE  PIP.PRDT_CD = CONCAT( 'COACHING', PPC.CATE_IDX ) AND PIP.INFO_ORDE = 0 AND PIP.INFO_USE_YN = 'Y') AS PRDT_NM1, (SELECT PIP.INFO_PRDT_TITL2 FROM PPM_INFO_PRDT PIP  WHERE  PIP.PRDT_CD = CONCAT( 'COACHING', PPC.CATE_IDX ) AND PIP.INFO_ORDE = 0 AND PIP.INFO_USE_YN = 'Y') AS PRDT_NM2,  CHAT_PRIC_REAL AS PRDT_PRIC_REAL, CHAT_PRIC AS PRDT_PRIC, CHAT_IMG_UUID AS PRDT_UUID, 'CHAT_IMG_UUID' AS PRDT_UUID_NM
						FROM PPM_SALE_CHAT PSC, PPM_PRDT_CHAT PPC WHERE SALE_USE_YN = 'Y' AND PSC.CHAT_IDX = PPC.CHAT_IDX AND PPC.CHAT_USE_YN = 'Y' AND PPC.CHAT_STAT_CD = 'SAL02'
				UNION ALL
						SELECT '2' AS PRDT_NUM, '1:1이메일상담' AS PRDT_TYPE, PSM.CATE_IDX, PSM.MAIL_IDX AS PRDT_IDX, PPM.MAIL_CNT AS PRDT_TIME, CONCAT( 'COACHING', PPM.CATE_IDX ) AS PRDT_CD, PPM.MAIL_CD AS PRDT_CD2, (SELECT PIP.INFO_PRDT_TITL1 FROM PPM_INFO_PRDT PIP  WHERE  PIP.PRDT_CD = CONCAT( 'COACHING', PPM.CATE_IDX ) AND PIP.INFO_ORDE = 0 AND PIP.INFO_USE_YN = 'Y') AS PRDT_NM1, (SELECT PIP.INFO_PRDT_TITL2 FROM PPM_INFO_PRDT PIP  WHERE  PIP.PRDT_CD = CONCAT( 'COACHING', PPM.CATE_IDX ) AND PIP.INFO_ORDE = 0 AND PIP.INFO_USE_YN = 'Y') AS PRDT_NM2, MAIL_PRIC_REAL AS PRDT_PRIC_REAL, MAIL_PRIC AS PRDT_PRIC, MAIL_IMG_UUID AS PRDT_UUID, 'MAIL_IMG_UUID' AS PRDT_UUID_NM
						FROM PPM_SALE_MAIL PSM, PPM_PRDT_MAIL PPM WHERE SALE_USE_YN = 'Y' AND PSM.MAIL_IDX = PPM.MAIL_IDX AND PPM.MAIL_USE_YN = 'Y' AND PPM.MAIL_STAT_CD = 'SAL02'
				UNION ALL
						SELECT '3' AS PRDT_NUM, 'LIVE CLASS' AS PRDT_TYPE, PSLI.CATE_IDX, PSLI.LIVE_IDX AS PRDT_IDX, (SELECT PPT.TIME_RUN FROM PPM_PRDT_TIME PPT WHERE PPT.LIVE_IDX = PPLI.LIVE_IDX AND PPT.TIME_USE_YN = 'Y' ORDER BY PPT.TIME_IDX DESC LIMIT 1) AS PRDT_TIME, PPLI.LIVE_CD AS PRDT_CD, PPLI.LIVE_CD AS PRDT_CD2, (SELECT PIP.INFO_PRDT_TITL1 FROM PPM_INFO_PRDT PIP  WHERE  PIP.PRDT_CD = PPLI.LIVE_CD AND PIP.INFO_ORDE = 0 AND PIP.INFO_USE_YN = 'Y') AS PRDT_NM1, (SELECT PIP.INFO_PRDT_TITL2 FROM PPM_INFO_PRDT PIP  WHERE  PIP.PRDT_CD = PPLI.LIVE_CD AND PIP.INFO_ORDE = 0 AND PIP.INFO_USE_YN = 'Y') AS PRDT_NM2, LIVE_PRIC_REAL AS PRDT_PRIC_REAL, LIVE_PRIC AS PRDT_PRIC, LIVE_IMG_UUID AS PRDT_UUID, 'LIVE_IMG_UUID' AS PRDT_UUID_NM
						FROM PPM_SALE_LIVE PSLI, PPM_PRDT_LIVE PPLI WHERE SALE_USE_YN = 'Y' AND PSLI.LIVE_IDX = PPLI.LIVE_IDX AND PPLI.LIVE_USE_YN = 'Y'  AND PPLI.LIVE_STAT_CD = 'SAL02'
			) PRDT,
			PPM_CATE PC,
			PPM_INFO_PRDT PIP
		
		WHERE 
			PRDT.CATE_IDX = PC.CATE_IDX 
			AND PRDT.CATE_IDX  = #{cateIdx}
			
			AND PIP.CATE_IDX = PC.CATE_IDX
			AND PIP.INFO_ORDE = 0
			AND PIP.INFO_USE_YN = 'Y'
			AND PIP.PRDT_CD = PRDT.PRDT_CD
		
		ORDER BY
			PRDT_NUM 
	]]>
	</select>
	
	<select id="selectFrontHomePrdtData" parameterType="hashmap" resultType="hashmap">
	<![CDATA[
	SELECT 
			(SELECT PC.CODE_ID FROM PPM_CATE PC WHERE PC.CATE_IDX = PRDT.CATE_IDX) CODE_ID,
			(SELECT PCD.CODE_NM FROM PPM_CODE PCD WHERE PCD.CODE_ID = (SELECT PC.CODE_ID FROM PPM_CATE PC WHERE PC.CATE_IDX = PRDT.CATE_IDX)) CODE_NM,
			(SELECT PCD.CODE_NM FROM PPM_CODE PCD WHERE PCD.CODE_ID = SUBSTRING((SELECT PC.CODE_ID FROM PPM_CATE PC WHERE PC.CATE_IDX = PRDT.CATE_IDX), 1,5 ) ) PARANT_CODE_NM,
			(SELECT USER_NM FROM PPM_USER WHERE USER_IDX = (SELECT PC.USER_IDX FROM PPM_CATE PC WHERE PC.CATE_IDX = PRDT.CATE_IDX)) MASTER_NM,
		
			PRDT_TYPE,
			CATE_IDX,
			PRDT_IDX,
			PRDT_CD,
			PRDT_NM1,
			PRDT_NM2,
			PRDT_PRIC_REAL,
			PRDT_PRIC ,
			PRDT_UUID, 
			PRDT_UUID_NM,
			
			IFNULL( (SELECT BASK_IDX FROM PPM_PRDT_BASK WHERE BASK_TYPE = 'K' AND BASK_USE_YN = 'Y' AND USER_IDX = #{userIdx} AND PPM_PRDT_BASK.BASK_PRDT_CD = PRDT.PRDT_CD), 0 ) BASK_IDX
			
			
			FROM
			
			(
					SELECT '1:1화상상담' AS PRDT_TYPE, PSF.CATE_IDX, PSF.FACE_IDX AS PRDT_IDX, PPF.FACE_CD AS PRDT_CD, (SELECT PIP.INFO_PRDT_TITL1 FROM PPM_INFO_PRDT PIP  WHERE  PIP.PRDT_CD = CONCAT( 'COACHING', PPF.CATE_IDX ) AND PIP.INFO_ORDE = 0 AND PIP.INFO_USE_YN = 'Y') AS PRDT_NM1, (SELECT PIP.INFO_PRDT_TITL2 FROM PPM_INFO_PRDT PIP  WHERE  PIP.PRDT_CD = CONCAT( 'COACHING', PPF.CATE_IDX ) AND PIP.INFO_ORDE = 0 AND PIP.INFO_USE_YN = 'Y') AS PRDT_NM2, FACE_PRIC_REAL AS PRDT_PRIC_REAL, FACE_PRIC AS PRDT_PRIC , FACE_IMG_UUID AS PRDT_UUID, 'FACE_IMG_UUID' AS PRDT_UUID_NM
					FROM PPM_SALE_FACE PSF, PPM_PRDT_FACE PPF WHERE SALE_USE_YN = 'Y' AND PSF.FACE_IDX = PPF.FACE_IDX AND PPF.FACE_USE_YN = 'Y' AND PPF.FACE_STAT_CD = 'SAL02'
				UNION ALL
					SELECT 'VOD' AS PRDT_TYPE, PSLE.CATE_IDX, PSLE.LECT_IDX AS PRDT_IDX, PPLE.LECT_CD AS PRDT_CD,(SELECT PIP.INFO_PRDT_TITL1 FROM PPM_INFO_PRDT PIP  WHERE  PIP.PRDT_CD = PPLE.LECT_CD AND PIP.INFO_ORDE = 0 AND PIP.INFO_USE_YN = 'Y') AS PRDT_NM1, (SELECT PIP.INFO_PRDT_TITL2 FROM PPM_INFO_PRDT PIP  WHERE  PIP.PRDT_CD = PPLE.LECT_CD AND PIP.INFO_ORDE = 0 AND PIP.INFO_USE_YN = 'Y') AS PRDT_NM2, LECT_PRIC_REAL AS PRDT_PRIC_REAL, LECT_PRIC AS PRDT_PRIC, LECT_UUID AS PRDT_UUID, 'LECT_UUID' AS PRDT_UUID_NM
					FROM PPM_SALE_LECT PSLE, PPM_PRDT_LECT PPLE WHERE SALE_USE_YN = 'Y' AND PPLE.LECT_USE_YN = 'Y' AND PSLE.LECT_IDX = PPLE.LECT_IDX AND PPLE.LECT_USE_YN = 'Y' AND PPLE.LECT_STAT_CD = 'SAL02'
				UNION ALL
					SELECT '1:1채팅상담' AS PRDT_TYPE, PSC.CATE_IDX, PSC.CHAT_IDX AS PRDT_IDX, PPC.CHAT_CD AS PRDT_CD, (SELECT PIP.INFO_PRDT_TITL1 FROM PPM_INFO_PRDT PIP  WHERE  PIP.PRDT_CD = CONCAT( 'COACHING', PPC.CATE_IDX ) AND PIP.INFO_ORDE = 0 AND PIP.INFO_USE_YN = 'Y') AS PRDT_NM1, (SELECT PIP.INFO_PRDT_TITL2 FROM PPM_INFO_PRDT PIP  WHERE  PIP.PRDT_CD = CONCAT( 'COACHING', PPC.CATE_IDX ) AND PIP.INFO_ORDE = 0 AND PIP.INFO_USE_YN = 'Y') AS PRDT_NM2,  CHAT_PRIC_REAL AS PRDT_PRIC_REAL, CHAT_PRIC AS PRDT_PRIC, CHAT_IMG_UUID AS PRDT_UUID, 'CHAT_IMG_UUID' AS PRDT_UUID_NM
					FROM PPM_SALE_CHAT PSC, PPM_PRDT_CHAT PPC WHERE SALE_USE_YN = 'Y' AND PSC.CHAT_IDX = PPC.CHAT_IDX AND PPC.CHAT_USE_YN = 'Y' AND PPC.CHAT_STAT_CD = 'SAL02'
				UNION ALL
					SELECT '1:1이메일상담' AS PRDT_TYPE, PSM.CATE_IDX, PSM.MAIL_IDX AS PRDT_IDX, PPM.MAIL_CD AS PRDT_CD, (SELECT PIP.INFO_PRDT_TITL1 FROM PPM_INFO_PRDT PIP  WHERE  PIP.PRDT_CD = CONCAT( 'COACHING', PPM.CATE_IDX ) AND PIP.INFO_ORDE = 0 AND PIP.INFO_USE_YN = 'Y') AS PRDT_NM1, (SELECT PIP.INFO_PRDT_TITL2 FROM PPM_INFO_PRDT PIP  WHERE  PIP.PRDT_CD = CONCAT( 'COACHING', PPM.CATE_IDX ) AND PIP.INFO_ORDE = 0 AND PIP.INFO_USE_YN = 'Y') AS PRDT_NM2, MAIL_PRIC_REAL AS PRDT_PRIC_REAL, MAIL_PRIC AS PRDT_PRIC, MAIL_IMG_UUID AS PRDT_UUID, 'MAIL_IMG_UUID' AS PRDT_UUID_NM
					FROM PPM_SALE_MAIL PSM, PPM_PRDT_MAIL PPM WHERE SALE_USE_YN = 'Y' AND PSM.MAIL_IDX = PPM.MAIL_IDX AND PPM.MAIL_USE_YN = 'Y' AND PPM.MAIL_STAT_CD = 'SAL02'
				UNION ALL
					SELECT '라이브클래스' AS PRDT_TYPE, PSLI.CATE_IDX, PSLI.LIVE_IDX AS PRDT_IDX, PPLI.LIVE_CD AS PRDT_CD, (SELECT PIP.INFO_PRDT_TITL1 FROM PPM_INFO_PRDT PIP  WHERE  PIP.PRDT_CD = PPLI.LIVE_CD AND PIP.INFO_ORDE = 0 AND PIP.INFO_USE_YN = 'Y') AS PRDT_NM1, (SELECT PIP.INFO_PRDT_TITL2 FROM PPM_INFO_PRDT PIP  WHERE  PIP.PRDT_CD = PPLI.LIVE_CD AND PIP.INFO_ORDE = 0 AND PIP.INFO_USE_YN = 'Y') AS PRDT_NM2, LIVE_PRIC_REAL AS PRDT_PRIC_REAL, LIVE_PRIC AS PRDT_PRIC, LIVE_IMG_UUID AS PRDT_UUID, 'LIVE_IMG_UUID' AS PRDT_UUID_NM
					FROM PPM_SALE_LIVE PSLI, PPM_PRDT_LIVE PPLI WHERE SALE_USE_YN = 'Y' AND PSLI.LIVE_IDX = PPLI.LIVE_IDX AND PPLI.LIVE_USE_YN = 'Y' AND PPLI.LIVE_STAT_CD = 'SAL02'
			) PRDT
			
				WHERE 
					PRDT.CATE_IDX IN 
						(SELECT CATE_IDX 
							FROM PPM_CATE PC 
							WHERE  
								PC.CODE_ID = (
									SELECT PC2.CODE_ID
										FROM 
											PPM_CATE PC2 
												WHERE PC2.CATE_IDX = #{cateIdx}
									)
								
								AND	CATE_USE_YN = 'Y'
							
							)
								
			ORDER BY BASK_IDX DESC		
		
	]]>
	</select>
	
	<select id="selectFrontPrdtDataCaoch" resultType="hashmap" parameterType="hashmap">
	<![CDATA[
		
		SELECT 
			PRDT.PRDT_TYPE , 
			PRDT.CATE_IDX , 
			PRDT.PRDT_IDX ,
			
			CONCAT( 'COACHING', PRDT.CATE_IDX ) PRDT_CD, 
			
			PRDT.PRDT_NM , 
			PRDT.PRDT_UUID , 
			PRDT.PRDT_UUID_NM , 
			PRDT.PRDT_STAT_CD , 
			PRDT.PRDT_REG_DTM , 
			IFNULL( (SELECT BASK_IDX FROM PPM_PRDT_BASK WHERE BASK_TYPE = 'K' AND BASK_USE_YN = 'Y' AND USER_IDX = #{frontLoginIdx} AND PPM_PRDT_BASK.BASK_PRDT_CD = PRDT.PRDT_CD), 0 ) BASK_IDX
	
		FROM 
			(
				SELECT '1:1코칭' AS PRDT_TYPE, PPF.CATE_IDX, PPF.FACE_IDX AS PRDT_IDX, PPF.FACE_CD AS PRDT_CD, (SELECT CONCAT(PIP.INFO_PRDT_TITL1, ' ', PIP.INFO_PRDT_TITL2 ) FROM PPM_INFO_PRDT PIP  WHERE  PIP.PRDT_CD = CONCAT( 'COACHING', PPF.CATE_IDX )  AND PIP.INFO_ORDE = 0 AND PIP.INFO_USE_YN = 'Y') AS PRDT_NM, FACE_IMG_UUID AS PRDT_UUID, 'FACE_IMG_UUID' AS PRDT_UUID_NM, FACE_STAT_CD AS PRDT_STAT_CD, PPF.SYS_REG_DTM AS PRDT_REG_DTM
				FROM PPM_PRDT_FACE PPF, PPM_SALE_FACE PSF
				WHERE SALE_USE_YN = 'Y' AND PSF.FACE_IDX = PPF.FACE_IDX AND PPF.FACE_USE_YN = 'Y' AND PPF.FACE_STAT_CD = 'SAL02'
			UNION ALL
				SELECT '1:1코칭' AS PRDT_TYPE, PPC.CATE_IDX, PPC.CHAT_IDX AS PRDT_IDX, PPC.CHAT_CD AS PRDT_CD, (SELECT CONCAT(PIP.INFO_PRDT_TITL1, ' ', PIP.INFO_PRDT_TITL2 ) FROM PPM_INFO_PRDT PIP  WHERE  PIP.PRDT_CD =  CONCAT( 'COACHING', PPC.CATE_IDX ) AND PIP.INFO_ORDE = 0 AND PIP.INFO_USE_YN = 'Y') AS PRDT_NM, CHAT_IMG_UUID AS PRDT_UUID, 'CHAT_IMG_UUID' AS PRDT_UUID_NM, CHAT_STAT_CD AS PRDT_STAT_CD, PPC.SYS_REG_DTM AS PRDT_REG_DTM
				FROM PPM_PRDT_CHAT PPC, PPM_SALE_CHAT PSC
				WHERE SALE_USE_YN = 'Y' AND PSC.CHAT_IDX = PPC.CHAT_IDX AND PPC.CHAT_USE_YN = 'Y' AND PPC.CHAT_STAT_CD = 'SAL02'
			UNION ALL
				SELECT '1:1코칭' AS PRDT_TYPE, PPM.CATE_IDX, PPM.MAIL_IDX AS PRDT_IDX, PPM.MAIL_CD AS PRDT_CD, (SELECT CONCAT(PIP.INFO_PRDT_TITL1, ' ', PIP.INFO_PRDT_TITL2 ) FROM PPM_INFO_PRDT PIP  WHERE  PIP.PRDT_CD = CONCAT( 'COACHING', PPM.CATE_IDX ) AND PIP.INFO_ORDE = 0 AND PIP.INFO_USE_YN = 'Y') AS PRDT_NM, MAIL_IMG_UUID AS PRDT_UUID, 'MAIL_IMG_UUID' AS PRDT_UUID_NM, MAIL_STAT_CD AS PRDT_STAT_CD, PPM.SYS_REG_DTM AS PRDT_REG_DTM
				FROM PPM_PRDT_MAIL PPM, PPM_SALE_MAIL PSM
				WHERE SALE_USE_YN = 'Y' AND PSM.MAIL_IDX = PPM.MAIL_IDX AND PPM.MAIL_USE_YN = 'Y' AND PPM.MAIL_STAT_CD = 'SAL02'
			) PRDT,
			PPM_CATE PC
			WHERE PRDT.CATE_IDX = PC.CATE_IDX 
			AND PRDT.CATE_IDX  = #{cateIdx}
			
			GROUP  BY PRDT_TYPE
		
	
	]]>
	</select>
	
	
<!-- 판매상품 영역 쿼리 --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  -->	
<!-- 판매상품 영역 쿼리 --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  -->	
<!-- 판매상품 영역 쿼리 --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  -->	
<!-- 판매상품 영역 쿼리 --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  -->	
<!-- 판매상품 영역 쿼리 --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  -->	
<!-- 판매상품 영역 쿼리 --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  -->	
<!-- 판매상품 영역 쿼리 --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  -->	
<!-- 판매상품 영역 쿼리 --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  -->	
<!-- 판매상품 영역 쿼리 --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  -->	
<!-- 판매상품 영역 쿼리 --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  -->	
<!-- 판매상품 영역 쿼리 --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  -->	
<!-- 판매상품 영역 쿼리 --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  --><!--  -->	
	
	<select id="selectFrontMasterPopList" parameterType="hashmap" resultType="hashmap">
	<if test="status not in {'LIST'}">
				<![CDATA[
SELECT C.* FROM (
  SELECT B.*, (@rownumB:=@rownumB+1) as NUM_ASC FROM(  
    SELECT A.*, (@rownumA:=@rownumA+1) as NUM_DESC FROM (
				]]>
			</if>
					<![CDATA[
						SELECT 
							${masterTab}_IDX AS TAB_IDX,
							PR.CATE_IDX, 
							(SELECT PU.USER_NM FROM PPM_USER PU WHERE PU.USER_IDX IN (SELECT PCC.USER_IDX FROM PPM_CATE PCC WHERE PCC.CATE_IDX = PR.CATE_IDX) ) MASTER_NM,
							${masterTab}_CD AS TAB_CD,
							(SELECT PC.CODE_NM FROM PPM_CODE PC WHERE PC.CODE_ID = ${masterTab}_STAT_CD)  AS TAB_STAT_CD, 
							${masterTab}_NM AS TAB_NM, 
							${masterTab}_USE_YN AS TAB_USE_YN,
							CASE #{masterTab} 
									WHEN 'CHAT' THEN '채팅 상담'
									WHEN 'FACE' THEN '화상 상담'
									WHEN 'LECT' THEN 'VOD 강좌'
									WHEN 'LIVE' THEN '라이브 클래스'
									WHEN 'MAIL' THEN '이메일 상담'
									ELSE '미확인강좌'
								END  AS "DIV",
							
							PR.SYS_REG_IDX,
							DATE_FORMAT(PR.SYS_REG_DTM, '%Y-%m-%d') SYS_REG_DTM,
							
						  	P_CODE.CODE_NM AS PARENT_CODE_NM,
						  	M_CODE.CODE_NM AS CODE_NM
							
						FROM 
							PPM_PRDT_${masterTab} PR
								LEFT JOIN PPM_CATE PC ON PR.CATE_IDX = PC.CATE_IDX
								LEFT JOIN PPM_CODE P_CODE ON SUBSTR(PC.CODE_ID,1,5) = P_CODE.CODE_ID
								LEFT JOIN PPM_CODE M_CODE ON PC.CODE_ID = M_CODE.CODE_ID
						WHERE 
							PR.CATE_IDX = #{cateIdx}
							AND ${masterTab}_USE_YN = 'Y'
							AND ${masterTab}_STAT_CD = 'SAL02'
					]]>
					<if test="selectVodSearch not in {'',null}">
							<![CDATA[
							
							-- ${masterTab}_NM LIKE '%${selectVodSearch}%' || 
							-- ${masterTab}_CD LIKE '%${selectVodSearch}%' ||
							--	AND ( ${masterTab}_CD LIKE '%${selectVodSearch}%' PR.CATE_IDX IN (SELECT CATE_IDX
							--																	FROM PPM_CATE PC 
							--																		WHERE PC.USER_IDX 
							--																			IN 
							--																			
							--																			(SELECT PU.USER_IDX 
							--																				FROM PPM_USER PU 
							--																					WHERE USER_NM LIKE '%${selectVodSearch}%'
							--																						AND USER_TYPE = 'M' 
							--																						AND USER_USE_YN = 'Y') ) )
							
							AND ${masterTab}_CD LIKE '%${selectVodSearch}%' 
													
							]]>
							</if>
					<if test="parentCodeId not in {'',null}"><![CDATA[
							AND P_CODE.CODE_ID =  #{parentCodeId}
					]]></if>
					<if test="codeId not in {'',null}"><![CDATA[
							AND M_CODE.CODE_ID =  #{codeId}
					]]></if>
			<if test="status not in {'LIST'}">
				<![CDATA[
										

						) A JOIN (SELECT @rownumA:=0) rownumA
  ) B JOIN (SELECT @rownumB:=0) rownumB ORDER BY TAB_IDX DESC
) C WHERE NUM_ASC BETWEEN '${startRow }' AND '${endRow }'
				]]>
			</if>				
							
	</select>

	<select id="selectFrontMasterPopListCnt" parameterType="hashmap" resultType="java.lang.Integer">
		<![CDATA[
			SELECT 
				COUNT(*) CNT
							
			FROM 
				PPM_PRDT_${masterTab} PR
					LEFT JOIN PPM_CATE PC ON PR.CATE_IDX = PC.CATE_IDX
					LEFT JOIN PPM_CODE P_CODE ON SUBSTR(PC.CODE_ID,1,5) = P_CODE.CODE_ID
					LEFT JOIN PPM_CODE M_CODE ON PC.CODE_ID = M_CODE.CODE_ID
			WHERE 
				PR.CATE_IDX = #{cateIdx}
				AND ${masterTab}_USE_YN = 'Y'
				AND ${masterTab}_STAT_CD = 'SAL02'
		]]>
		<if test="selectVodSearch not in {'',null}">
				<![CDATA[
				
				-- ${masterTab}_NM LIKE '%${selectVodSearch}%' || 
				-- ${masterTab}_CD LIKE '%${selectVodSearch}%' ||
				--	AND ( ${masterTab}_CD LIKE '%${selectVodSearch}%' PR.CATE_IDX IN (SELECT CATE_IDX
				--																	FROM PPM_CATE PC 
				--																		WHERE PC.USER_IDX 
				--																			IN 
				--																			
				--																			(SELECT PU.USER_IDX 
				--																				FROM PPM_USER PU 
				--																					WHERE USER_NM LIKE '%${selectVodSearch}%'
				--																						AND USER_TYPE = 'M' 
				--																						AND USER_USE_YN = 'Y') ) )
				
				AND ${masterTab}_CD LIKE '%${selectVodSearch}%' 
										
				]]>
				</if>
		<if test="parentCodeId not in {'',null}"><![CDATA[
				AND P_CODE.CODE_ID =  #{parentCodeId}
		]]></if>
		<if test="codeId not in {'',null}"><![CDATA[
				AND M_CODE.CODE_ID =  #{codeId}
		]]></if>
	</select>

	<select id="selectFrontMasterSaleDataList" parameterType="hashmap" resultType="hashmap">
		<![CDATA[
			SELECT
				SALE_IDX,
				T1.CATE_IDX,
				T1.${masterTab}_IDX,
				SALE_ORDE,
				${masterTab}_CD,
				${masterTab}_NM, 
				(SELECT PU.USER_NM FROM PPM_USER PU WHERE PU.USER_IDX IN (SELECT PC.USER_IDX FROM PPM_CATE PC WHERE PC.CATE_IDX = T1.CATE_IDX) ) MASTER_NM, 
				(SELECT PC.CODE_NM FROM PPM_CODE PC WHERE PC.CODE_ID = ${masterTab}_STAT_CD) ${masterTab}_STAT_CD,
				
				T1.SYS_REG_IDX ,
				DATE_FORMAT(T1.SYS_REG_DTM, '%Y-%m-%d') SYS_REG_DTM
				
				FROM
					PPM_SALE_${masterTab} T1, PPM_PRDT_${masterTab} T2
					
						WHERE 
							T1.CATE_IDX = #{cateIdx} 
							AND SALE_USE_YN = 'Y' 
							AND T1.${masterTab}_IDX = T2.${masterTab}_IDX
										
				]]>
	</select>
	
	
	<select id="selectFrontMasterBuyDetail" parameterType="hashmap" resultType="hashmap">
	<![CDATA[
	SELECT DISTINCT
		PRDT.CATE_IDX,
		PRDT.PRDT_CD,
		INFO_PRDT_TITL1,
		INFO_PRDT_TITL2,
		PU.USER_NM ,
		P_CODE.CODE_NM AS P_CODE_NM,
		M_CODE.CODE_NM AS M_CODE_NM,
		(
			CASE
				WHEN PRDT.PRDT_CD LIKE '%VL%' THEN ( SELECT LECT_DTM FROM PPM_PRDT_LECT WHERE LECT_CD = PRDT.PRDT_CD )
				WHEN PRDT.PRDT_CD LIKE '%EN%' THEN ( SELECT MAIL_CNT FROM PPM_PRDT_MAIL WHERE MAIL_CD = PRDT.PRDT_CD )
				WHEN PRDT.PRDT_CD LIKE '%FN%' THEN ( SELECT TIME_RUN FROM PPM_PRDT_TIME WHERE FACE_IDX = PRDT.PRDT_IDX ORDER BY TIME_IDX DESC LIMIT 1 )
				WHEN PRDT.PRDT_CD LIKE '%CN%' THEN ( SELECT TIME_RUN FROM PPM_PRDT_TIME WHERE CHAT_IDX = PRDT.PRDT_IDX ORDER BY TIME_IDX DESC LIMIT 1 )
				WHEN PRDT.PRDT_CD LIKE '%LN%' THEN ( SELECT TIME_RUN FROM PPM_PRDT_TIME WHERE LIVE_IDX = PRDT.PRDT_IDX ORDER BY TIME_IDX DESC LIMIT 1 )
			END
		) AS PRDT_CNT,
		
		( SELECT MAIL_DTM_CNT FROM PPM_PRDT_MAIL WHERE MAIL_CD = PRDT.PRDT_CD ) AS MAIL_DTM_CNT,
		
		
		( SELECT LIVE_ACAD_YN FROM PPM_PRDT_LIVE WHERE LIVE_CD = PRDT.PRDT_CD ) AS LIVE_ACAD_YN,
		
		DATEDIFF(( SELECT PPT.TIME_DTM FROM PPM_PRDT_LIVE PPL, PPM_PRDT_TIME PPT WHERE PPL.LIVE_IDX = PPT.LIVE_IDX AND PPT.TIME_USE_YN = 'Y' AND  PPL.LIVE_CD = PRDT.PRDT_CD ORDER BY PPT.TIME_IDX DESC LIMIT 1 ), ( SELECT PPT.TIME_DTM FROM PPM_PRDT_LIVE PPL, PPM_PRDT_TIME PPT WHERE PPL.LIVE_IDX = PPT.LIVE_IDX AND PPT.TIME_USE_YN = 'Y' AND  PPL.LIVE_CD = PRDT.PRDT_CD ORDER BY PPT.TIME_IDX ASC LIMIT 1  )) LIVE_DTM,  
		
		
		(
			SELECT COUNT(0) FROM PPM_PRDT_LECT PPL LEFT JOIN PPM_PRDT_LECT_DATA PPLD ON PPL.LECT_IDX = PPLD.LECT_IDX LEFT JOIN PPM_PRDT_VOD_DATA PPVD ON PPLD.VOD_IDX = PPVD.VOD_IDX
			WHERE LECT_CD = PRDT.PRDT_CD AND PPLD.DATA_USE_YN = 'Y' AND PPVD.DATA_USE_YN = 'Y'
		) AS LECT_TOTAL_CNT,
		
		(
			SELECT SUM(DATA_RUNN) FROM PPM_PRDT_LECT PPL LEFT JOIN PPM_PRDT_LECT_DATA PPLD ON PPL.LECT_IDX = PPLD.LECT_IDX LEFT JOIN PPM_PRDT_VOD_DATA PPVD ON PPLD.VOD_IDX = PPVD.VOD_IDX
			WHERE LECT_CD = PRDT.PRDT_CD AND PPLD.DATA_USE_YN = 'Y' AND PPVD.DATA_USE_YN = 'Y'
		) AS LECT_TOTAL_MIN_CNT,
				
		DATE_FORMAT(NOW(), '%Y년 %m월 %d일') AS SYS_REG_DTM,
		(
			CASE WEEKDAY( NOW() ) 
			    WHEN '0' THEN '월'
			    WHEN '1' THEN '화'
			    WHEN '2' THEN '수'
			    WHEN '3' THEN '목'
			    WHEN '4' THEN '금'
			    WHEN '5' THEN '토'
			    WHEN '6' THEN '일'
			END
		) AS SYS_REG_DTM_WEEK,
		FORMAT( PRDT_PRIC_REAL, 0 ) AS PRDT_PRIC_REAL
	FROM
		PPM_SALE_CD_VIEW PRDT
			LEFT JOIN PPM_CATE PC ON PRDT.CATE_IDX = PC.CATE_IDX
			LEFT JOIN PPM_USER PU ON PC.USER_IDX = PU.USER_IDX
			LEFT JOIN PPM_CODE P_CODE ON SUBSTR(PC.CODE_ID,1,5) = P_CODE.CODE_ID
			LEFT JOIN PPM_CODE M_CODE ON PC.CODE_ID = M_CODE.CODE_ID
			LEFT JOIN PPM_INFO_PRDT PIP ON PIP.CATE_IDX = PC.CATE_IDX
	WHERE
		PRDT.CATE_IDX IN ( SELECT CATE_IDX FROM PPM_CATE PC WHERE CATE_IDX = #{cateIdx} AND  CATE_USE_YN = 'Y')
		AND PIP.INFO_USE_YN = 'Y'
		AND PIP.INFO_ORDE = '0'
		AND PRDT.PRDT_CD = #{prdtCd }
		AND PIP.INFO_PRDT_TITL1 = 
		CASE 
			WHEN #{prdtCd } LIKE '%LN%' OR #{prdtCd } LIKE '%VL%' THEN (SELECT PIP2.INFO_PRDT_TITL1 FROM PPM_INFO_PRDT PIP2 WHERE PIP2.PRDT_CD = #{prdtCd } AND PIP2.INFO_ORDE  = 0 AND PIP2.INFO_USE_YN= 'Y' ) 
			ELSE (SELECT PIP2.INFO_PRDT_TITL1 FROM PPM_INFO_PRDT PIP2 WHERE PIP2.PRDT_CD = CONCAT('COACHING', PRDT.CATE_IDX ) AND PIP2.INFO_ORDE  = 0 AND PIP2.INFO_USE_YN= 'Y' ) 
		END 
		]]>
	<if test="now not in { null, ''}">
		<![CDATA[
		AND REPLACE(PIP.PRDT_CD, 'COACHING','') = PC.CATE_IDX
		]]>
	</if>
	</select>
	
	
	<select id="selectFrontMasterBuyList" parameterType="hashmap" resultType="hashmap">
	<![CDATA[
		SELECT
			CATE_IDX,
			PRDT_CD,
			P_CODE_NM,
			M_CODE_NM,
			PRDT_CNT,
			SYS_REG_DTM,
			SYS_REG_DTM_WEEK,
			PRDT_PRIC_REAL,
			PRDT_DISC,
			DISC_CODE_NM,
			LATELY_TIME
		FROM (
			SELECT
				PRDT.CATE_IDX,
				PRDT.PRDT_CD,
				P_CODE.CODE_NM AS P_CODE_NM,
				M_CODE.CODE_NM AS M_CODE_NM,
				(
					CASE
						WHEN PRDT.PRDT_CD LIKE '%VL%' THEN ( SELECT LECT_DTM FROM PPM_PRDT_LECT WHERE LECT_CD = PRDT.PRDT_CD )
						WHEN PRDT.PRDT_CD LIKE '%EN%' THEN ( SELECT MAIL_CNT FROM PPM_PRDT_MAIL WHERE MAIL_CD = PRDT.PRDT_CD )
						WHEN PRDT.PRDT_CD LIKE '%FN%' THEN ( SELECT TIME_RUN FROM PPM_PRDT_TIME WHERE FACE_IDX = PRDT.PRDT_IDX ORDER BY TIME_IDX DESC LIMIT 1 )
						WHEN PRDT.PRDT_CD LIKE '%CN%' THEN ( SELECT TIME_RUN FROM PPM_PRDT_TIME WHERE CHAT_IDX = PRDT.PRDT_IDX ORDER BY TIME_IDX DESC LIMIT 1 )
						WHEN PRDT.PRDT_CD LIKE '%LN%' THEN ( SELECT TIME_RUN FROM PPM_PRDT_TIME WHERE LIVE_IDX = PRDT.PRDT_IDX ORDER BY TIME_IDX DESC LIMIT 1 )
					END
				) AS PRDT_CNT,
				DATE_FORMAT(NOW(), '%Y년 %m월 %d일') AS SYS_REG_DTM,
				(
					case WEEKDAY( NOW() ) 
					    when '0' then '월'
					    when '1' then '화'
					    when '2' then '수'
					    when '3' then '목'
					    when '4' then '금'
					    when '5' then '토'
					    when '6' then '일'
					END
				) AS SYS_REG_DTM_WEEK,
				FORMAT( PRDT_PRIC_REAL, 0 ) AS PRDT_PRIC_REAL,
				PRDT.PRDT_DISC,
				DISC_CODE.CODE_NM AS DISC_CODE_NM,
				(
					CASE
						WHEN PRDT.PRDT_CD LIKE '%FN%' THEN (
							SELECT
								TIME_STR
							FROM
								PPM_PRDT_TIME
							WHERE
								FACE_IDX = PRDT.PRDT_IDX
								AND DATEDIFF(TIME_DTM, NOW()) = 0
								AND DATE_FORMAT(TIME_DTM, '%Y-%m-%d') = DATE_FORMAT(NOW(), '%Y-%m-%d')
								AND ( DATE_FORMAT(CONCAT( TIME_DTM, ' ' ,TIME_STR ), '%Y-%m-%d %H:%i') < DATE_FORMAT(NOW(), '%Y-%m-%d %H:%i') ) = 0
							--	AND DATE_FORMAT(TIMEDIFF( TIME_STR, DATE_FORMAT(NOW(), '%H:%i') ), '%H:%i') <= DATE_FORMAT('0000-00-00 1:0:0', '%H:%i')
							--	AND DATE_FORMAT(TIMEDIFF( TIME_STR, DATE_FORMAT(NOW(), '%H:%i') ), '%H:%i') NOT LIKE '%-%'
							ORDER BY
								TIME_STR 
							LIMIT 1 )
						WHEN PRDT.PRDT_CD LIKE '%CN%' THEN (
							SELECT
								TIME_STR
							FROM
								PPM_PRDT_TIME
							WHERE
								CHAT_IDX = PRDT.PRDT_IDX
								AND DATEDIFF(TIME_DTM, NOW()) = 0
								AND DATE_FORMAT(TIME_DTM, '%Y-%m-%d') = DATE_FORMAT(NOW(), '%Y-%m-%d')
								AND ( DATE_FORMAT(CONCAT( TIME_DTM, ' ' ,TIME_STR ), '%Y-%m-%d %H:%i') < DATE_FORMAT(NOW(), '%Y-%m-%d %H:%i') ) = 0
							--	AND DATE_FORMAT(TIMEDIFF( TIME_STR, DATE_FORMAT(NOW(), '%H:%i') ), '%H:%i') <= DATE_FORMAT('0000-00-00 1:0:0', '%H:%i')
							--	AND DATE_FORMAT(TIMEDIFF( TIME_STR, DATE_FORMAT(NOW(), '%H:%i') ), '%H:%i') NOT LIKE '%-%'
							ORDER BY
								TIME_STR 
							LIMIT 1 )
						WHEN PRDT.PRDT_CD LIKE '%LN%' THEN (
							SELECT
								TIME_STR
							FROM
								PPM_PRDT_TIME
							WHERE
								LIVE_IDX = PRDT.PRDT_IDX
								AND DATEDIFF(TIME_DTM, NOW()) = 0
								AND DATE_FORMAT(TIME_DTM, '%Y-%m-%d') = DATE_FORMAT(NOW(), '%Y-%m-%d')
								AND ( DATE_FORMAT(CONCAT( TIME_DTM, ' ' ,TIME_STR ), '%Y-%m-%d %H:%i') < DATE_FORMAT(NOW(), '%Y-%m-%d %H:%i') ) = 0
							--	AND DATE_FORMAT(TIMEDIFF( TIME_STR, DATE_FORMAT(NOW(), '%H:%i') ), '%H:%i') <= DATE_FORMAT('0000-00-00 1:0:0', '%H:%i')
							--	AND DATE_FORMAT(TIMEDIFF( TIME_STR, DATE_FORMAT(NOW(), '%H:%i') ), '%H:%i') NOT LIKE '%-%'
							ORDER BY
								TIME_STR 
							LIMIT 1 )
					END
				) AS LATELY_TIME
			FROM
				PPM_SALE_CD_VIEW PRDT
					LEFT JOIN PPM_CATE PC ON PRDT.CATE_IDX = PC.CATE_IDX
					LEFT JOIN PPM_USER PU ON PC.USER_IDX = PU.USER_IDX
					LEFT JOIN PPM_CODE P_CODE ON SUBSTR(PC.CODE_ID,1,5) = P_CODE.CODE_ID
					LEFT JOIN PPM_CODE M_CODE ON PC.CODE_ID = M_CODE.CODE_ID
					LEFT JOIN PPM_CODE DISC_CODE ON PRDT.PRDT_DISC_CD = DISC_CODE.CODE_ID
			WHERE
				( PRDT.PRDT_CD LIKE '%FN%' OR PRDT.PRDT_CD LIKE '%CN%' OR PRDT.PRDT_CD LIKE '%LN%' )
				AND PRDT.CATE_IDX =  #{cateIdx }
			) SUB
		WHERE
			LATELY_TIME IS NOT NULL
		]]>
	</select>
	
	<select id="selectFrontMasterBuyTimeList" parameterType="hashmap" resultType="hashmap">
	<![CDATA[
			SELECT
				TIME_IDX,
				LIVE_IDX,
				FACE_IDX,
				CHAT_IDX,
				DATE_FORMAT( TIME_DTM ,'%Y-%m-%d' ) TIME_DTM,
				TIME_STR,
				(
					CASE WEEKDAY( TIME_DTM ) 
					    WHEN '0' THEN '월'
					    WHEN '1' THEN '화'
					    WHEN '2' THEN '수'
					    WHEN '3' THEN '목'
					    WHEN '4' THEN '금'
					    WHEN '5' THEN '토'
					    WHEN '6' THEN '일'
					END
				) AS TIME_DTM_WEEK
			FROM	
				PPM_PRDT_TIME
			WHERE
				(
					CHAT_IDX = ( SELECT CHAT_IDX FROM PPM_PRDT_CHAT WHERE CHAT_CD = #{prdtCd } )
					OR LIVE_IDX = ( SELECT LIVE_IDX FROM PPM_PRDT_LIVE WHERE LIVE_CD = #{prdtCd } )
					OR FACE_IDX = ( SELECT FACE_IDX FROM PPM_PRDT_FACE WHERE FACE_CD = #{prdtCd } )
				)
				AND DATEDIFF(TIME_DTM, NOW()) >= 0
				AND TIME_USE_YN = 'Y'
				AND ( DATE_FORMAT(CONCAT( TIME_DTM, ' ' ,TIME_STR ), '%Y-%m-%d %H:%i') < DATE_FORMAT(NOW(), '%Y-%m-%d %H:%i') ) = 0 
				]]>
			<if test="timeDtm not in {null, ''}">
				<![CDATA[
				AND DATE_FORMAT( TIME_DTM, '%Y-%m-%d' ) = DATE_FORMAT(  #{timeDtm }, '%Y-%m-%d' )
				]]>
			</if>
		<![CDATA[
		
				
			ORDER BY
				TIME_DTM, TIME_STR
		-- LIMIT 7
		]]>
	</select>
	
	<select id="selectFrontMasterBuyQuesList" parameterType="hashmap" resultType="hashmap">
	<![CDATA[
			SELECT
				QUES_IDX,
				QUES_CNTN
			FROM
				PPM_PRDT_QUES PPQ
			-- 		LEFT JOIN PPM_PRDT_QUES_DATA PPQD ON PPQ.QUES_IDX = PPQD.QUES_IDX
			WHERE
				(
					PPQ.CHAT_IDX = ( SELECT CHAT_IDX FROM PPM_PRDT_CHAT WHERE CHAT_CD = #{prdtCd } )
					OR PPQ.LIVE_IDX = ( SELECT LIVE_IDX FROM PPM_PRDT_LIVE WHERE LIVE_CD = #{prdtCd } )
					OR PPQ.FACE_IDX = ( SELECT FACE_IDX FROM PPM_PRDT_FACE WHERE FACE_CD = #{prdtCd } )
				)
				AND PPQ.QUES_USE_YN = 'Y'
			-- 	AND PPQD.DATA_USE_YN = 'Y'
			-- 	AND PPQD.USER_IDX = 4
			ORDER BY
				PPQ.QUES_IDX
		]]>
	</select>
	
	<select id="selectUserBuyTimeIdx" parameterType="hashmap" resultType="hashmap">
<![CDATA[
	SELECT 
			(SELECT CONCAT( TIME_DTM, ' ', TIME_STR ) FROM PPM_PRDT_TIME PPT WHERE PPT.TIME_IDX = #{timeIdx} ) NO_TIME,	
			(SELECT CONCAT( PIP.INFO_PRDT_TITL1, ' ', PIP.INFO_PRDT_TITL2 ) FROM PPM_INFO_PRDT PIP 
				WHERE PIP.PRDT_CD = ( CASE 
				WHEN PUB.BUY_PRDT_CD LIKE '%CN%' THEN CONCAT( 'COACHING',PUB.CATE_IDX ) 
				WHEN PUB.BUY_PRDT_CD LIKE '%FN%' THEN CONCAT( 'COACHING',PUB.CATE_IDX ) 
				WHEN PUB.BUY_PRDT_CD LIKE '%LN%' THEN PUB.BUY_PRDT_CD
			END ) AND PIP.INFO_ORDE = 0 ) NO_TITL,
			
			(SELECT LIVE_CNT FROM PPM_PRDT_LIVE WHERE LIVE_CD = PUB.BUY_PRDT_CD ) LIVE_CNT

		
		FROM PPM_USER_BUY PUB 
			WHERE PUB.BUY_PRDT_CD = #{prdtCd} AND PUB.TIME_IDX = #{timeIdx}
			AND ( PUB.BUY_STAT = '결제완료' OR ( PUB.BUY_STAT = '입금대기' AND DATEDIFF( NOW(), PUB.SYS_REG_DTM ) < 3 ) )
]]>
</select>	
	
	
	
	<insert id="insertFrontMasterQuesData" parameterType="hashmap">
	<![CDATA[
		INSERT INTO
			PPM_PRDT_QUES_DATA
			(
				QUES_IDX, 
				USER_IDX, 
				DATA_CNTN,
				DATA_USE_YN, 
				
				SYS_REG_IDX, 
				SYS_REG_DTM, 
				SYS_MOD_IDX, 
				SYS_MOD_DTM
			) VALUES (
				#{quesIdx}, 
				#{frontLoginIdx}, 
				#{dataCntn}, 
				'Y', 
				
				#{frontLoginIdx}, 
				DATE_FORMAT(NOW(), '%Y-%m-%d %H:%i:%S'), 
				#{frontLoginIdx}, 
				DATE_FORMAT(NOW(), '%Y-%m-%d %H:%i:%S')
			)
		]]>
	</insert>
	
	<select id="selectFrontBaskData" parameterType="hashmap" resultType="hashmap"> 
	<![CDATA[
		SELECT  
				
				*
				
			FROM	
				PPM_PRDT_BASK
				
					WHERE
						BASK_PRDT_CD = #{baskPrdtCd}
						AND CATE_IDX = #{cateIdx}
						AND USER_IDX = #{frontLoginIdx}
						AND BASK_TYPE = #{baskType}
						AND SYS_REG_IDX = #{frontLoginIdx}
	
		]]>
	</select>
	
		<select id="selectFrontJjimCoachPrdtCd" parameterType="hashmap" resultType="hashmap">
		<![CDATA[
		SELECT
			CATE_IDX,
			PRDT_IDX,
			PRDT_CD
		
			FROM 
				PPM_SALE_CD_VIEW PSCV 
				WHERE 
				CATE_IDX = #{cateIdx}
				AND 
				( PRDT_CD LIKE '%CN%'
				OR PRDT_CD LIKE '%EN%'
				OR PRDT_CD LIKE '%FN%' )
		]]>
	</select>
	
</mapper>

